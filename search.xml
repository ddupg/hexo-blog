<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>HBase: SCP &amp; TRSP</title>
    <url>/blog/2020/04/15/SCP&amp;TRSP/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨ç»„å†…è¿›è¡Œçš„ä¸€æ¬¡SCPå’ŒTRSPä¸¤ä¸ªProcedureæ‰§è¡Œè¿‡ç¨‹çš„åˆ†äº«ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ‡’å¾—å»æ•´ç†å‡ºæ–‡ç« äº† ğŸ˜œ</p>
<a id="more"></a>
<h2 id="AMv2">AMv2</h2>
<h3 id="æ¯”è¾ƒé‡è¦çš„ç±»">æ¯”è¾ƒé‡è¦çš„ç±»</h3>
<p><img src="amv2.png" alt="AMv2ä¸»è¦çš„ç±»"></p>
<h4 id="AssignmentManager">AssignmentManager</h4>
<p>ç®¡ç†Regionçš„assign/unassignæ“ä½œï¼Œç®¡ç†Regionçš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>å…¶ä¸­ä¸»è¦å±æ€§ï¼š</p>
<ul>
<li>RegionStates: ç®¡ç†å†…å­˜ä¸­çš„RegionçŠ¶æ€ä¿¡æ¯ï¼ŒRSä¸Šæœ‰å“ªäº›region</li>
<li>RegionStateStore: æ“ä½œmetaè¡¨</li>
</ul>
<h4 id="RegionStateNode">RegionStateNode</h4>
<ul>
<li>lock: å¯¹RegionçŠ¶æ€ä¿¡æ¯å’ŒRegionLoacationä¿¡æ¯åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹ã€‚</li>
<li>regionInfo: Regionä¿¡æ¯</li>
<li>event: ç”¨äºå¤šä¸ªprocedureç­‰å¾…Regionçš„æŸä¸ªçŠ¶æ€å˜åŒ–ï¼Œæ¯”å¦‚openã€closeã€‚</li>
<li>procedure: è®°å½•å”¯ä¸€ç»‘å®šçš„TRSPï¼Œä¿è¯æ¯ä¸ªRegionåªèƒ½åŒæ—¶è¿›è¡Œä¸€ä¸ªTRSPã€‚</li>
<li>regionLocation: regionè¦è¢«assignåˆ°å“ªä¸ªRSã€‚</li>
</ul>
<h4 id="ProcedureEvent">ProcedureEvent</h4>
<p>ç”¨äºå¤šä¸ªProcedureç­‰å¾…æŸä¸ªä¾èµ–çš„äº‹ä»¶ï¼Œåœ¨AMv2ä¸­ï¼Œä¸»è¦çš„å°±æ˜¯ç­‰å¾…Regionçš„çŠ¶æ€å˜åŒ–ã€‚</p>
<p><img src="ProcedureEvent.png" alt="ProcedureEvent"></p>
<p>äº‹ä»¶çŠ¶æ€å°±ä¸¤ç§ï¼š</p>
<ul>
<li>ready: æŸä¸ªäº‹ä»¶å·²å‡†å¤‡å¥½ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ</li>
<li>suspend: äº‹ä»¶æœªå‡†å¤‡å¥½ï¼Œä¹‹åè°ƒç”¨suspendIfNotReady()æ–¹æ³•çš„Procedureéƒ½ä¼šè¢«åŠ åˆ° suspendedProcedureé˜Ÿåˆ—é‡Œï¼Œç”¨äºä¹‹åå”¤é†’ã€‚</li>
</ul>
<p>ä¸»è¦æ–¹æ³•ï¼š</p>
<ul>
<li>suspendIfNotReady: å¦‚æœæ˜¯readyçŠ¶æ€ï¼Œè¡¨ç¤ºå¯ä»¥ç»§ç»­æ‰§è¡Œï¼›å¦‚æœsuspendçŠ¶æ€ï¼ŒProcedureä¼šè¢«åŠ åˆ° suspendedProcedureé˜Ÿåˆ—é‡Œï¼Œç”¨äºä¹‹åå”¤é†’ã€‚è¿™æ—¶å€™Procedureä¼šæŠ›å‡ºProcedureSuspendedExceptionï¼ŒPv2æ¡†æ¶ä¼šæš‚åœProcedureçš„æ‰§è¡Œï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</li>
</ul>
<p>è¿™ä¸ªåŠŸèƒ½æœ‰ä¸ªé—®é¢˜å°±æ˜¯åªä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ— æ³•æ¢å¤ï¼Œå¦‚æœProcedureä½¿ç”¨ä¸å¥½ï¼ŒMasteré‡å¯ï¼Œç­‰å¾…é˜Ÿåˆ—æ— æ³•æ¢å¤ï¼ŒProcedureå¯èƒ½æ°¸è¿œæ— æ³•è¢«å”¤é†’ã€‚</p>
<h2 id="ServerCrashProcedure">ServerCrashProcedure</h2>
<h3 id="è§¦å‘æ¡ä»¶">è§¦å‘æ¡ä»¶</h3>
<h4 id="zk-session-expireï¼ˆè¢«åŠ¨è§¦å‘ï¼‰">zk session expireï¼ˆè¢«åŠ¨è§¦å‘ï¼‰</h4>
<p>ç›‘å¬zkä¸ŠrsèŠ‚ç‚¹çš„å˜åŒ–ï¼Œå¦‚æœä»£è¡¨æŸä¸ªrsçš„å­èŠ‚ç‚¹è¢«è¿‡æœŸåˆ é™¤ï¼Œå°±è§¦å‘SCPã€‚</p>
<p>é…ç½®: {zookeeper.znode.parent}/{<a href="http://zookeeper.znode.rs" target="_blank" rel="noopener">zookeeper.znode.rs</a>}/</p>
<p>é»˜è®¤: /hbase/{cluster name}/rs/</p>
<p>æ­¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœrså¤„äºéONLINEçŠ¶æ€ï¼Œä¸ä¼šå¼ºåˆ¶æ‰§è¡ŒServerCrashProcedure</p>
<h4 id="HBCK2-ï¼ˆä¸»åŠ¨è§¦å‘ï¼‰">HBCK2 ï¼ˆä¸»åŠ¨è§¦å‘ï¼‰</h4>
<p>è¦ä½¿ç”¨å®Œæ•´çš„ServerNameï¼ŒåŒ…å«åé¢çš„startcodeã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;hbase hbck -j hbase-hbck2-1.0.0-SNAPSHOT.jar scheduleRecoveries c4-hadoop-tst-st84.bj,55600,1586416554312 c4-hadoop-tst-st85.bj,55600,1586415546993</span><br></pre></td></tr></table></figure>
<p>æ— è®ºrsæ˜¯å¦å¤„äºONLINEçŠ¶æ€ï¼Œéƒ½ä¼šå¼ºåˆ¶æ‰§è¡Œ HBCKServerCrashProcedureï¼ˆServerCrashProcedureçš„å­ç±»ï¼‰ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹è¡Œä¸ºå’ŒServerCrashProcedureä¸€æ ·ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºgetRegionsOnCrashedServeræ–¹æ³•ï¼š</p>
<p>å¦‚æœServerCrashProcedure.getRegionsOnCrashedServerè¿”å›ç©ºé›†åˆï¼ŒHBCKServerCarshProcedureä¼šscanè¯»metaè¡¨ï¼Œå°†metaè¡¨ä¸Šè®°å½•çš„Openingå’ŒOpenedä¸¤ç§çŠ¶æ€çš„regionè¿”å›ï¼Œå¦å¤–å°†ClosingçŠ¶æ€çš„regionæ”¹ä¸ºCloseã€‚</p>
<h3 id="çŠ¶æ€å˜åŒ–">çŠ¶æ€å˜åŒ–</h3>
<p><strong>å‡†å¤‡å·¥ä½œ</strong></p>
<p>å°†å½“å‰å¤„ç†çš„rsåŠ åˆ° DeadServer processing listã€‚åœ¨SCPæ‰§è¡Œç»“æŸä¹‹åï¼Œæ‰åŠ åˆ° DeadServers listã€‚æ¯ä¸ªçŠ¶æ€éƒ½ä¼šæ£€æŸ¥ä¸‹ï¼Œæ˜¯å¦åŠ è¿›å»äº†ã€‚</p>
<p><strong>ç­‰å¾…metaè¡¨å¯ç”¨</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case SERVER_CRASH_START:</span><br><span class="line">case SERVER_CRASH_SPLIT_META_LOGS:</span><br><span class="line">case SERVER_CRASH_DELETE_SPLIT_META_WALS_DIR:</span><br><span class="line">case SERVER_CRASH_ASSIGN_META:</span><br><span class="line">break;</span><br><span class="line">default:</span><br><span class="line">&#x2F;&#x2F; If hbase:meta is not assigned, yield.</span><br><span class="line">if (env.getAssignmentManager().waitMetaLoaded(this)) &#123;</span><br><span class="line">    throw new ProcedureSuspendedException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‰é¢å‡ ä¸ªçŠ¶æ€éƒ½æ˜¯æ“ä½œmetaè¡¨çš„regionçš„çŠ¶æ€ï¼Œæ‰€ä»¥metaè¡¨ä¸å¯ç”¨ä¹Ÿä¼šæ‰§è¡Œï¼Œå…¶ä»–çš„çŠ¶æ€ä¼šæ“ä½œæ™®é€šregionï¼Œæ¶‰åŠåˆ°metaè¡¨çš„è¯»å†™ï¼Œæ‰€ä»¥å…¶ä»–çŠ¶æ€éƒ½è¦æ±‚metaè¡¨çš„regionå¯ç”¨ï¼Œæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚è¿™é‡Œå°±åˆ©ç”¨äº†ProcedureEventè¿™ä¸ªç±»çš„åŠŸèƒ½ï¼Œç­‰å¾…meta regionåŠ è½½å®Œæˆä¹‹åæ‰å…è®¸ç»§ç»­ä¸‹é¢çš„çŠ¶æ€ï¼Œå¦åˆ™ç›´æ¥æŠ›å‡ºProcedureSuspendedExceptionæš‚åœå½“å‰Procedureçš„æ‰§è¡Œï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p>
<p><strong>ä½†è¿™é‡Œå¥½åƒä½¿ç”¨AssignmentManager.metaAssignEventæ›´åˆé€‚</strong>ã€‚å› ä¸ºmeatLoadedEventåªæœ‰åœ¨Masterå¯åŠ¨ä¹‹åæ‰ä¼šè§¦å‘ä¸€æ¬¡ï¼ŒmetaAssignEventåœ¨Masterå¯åŠ¨å’Œæ¯æ¬¡meta region openéƒ½ä¼šè§¦å‘ï¼Œæ‰€ä»¥metaAssignEventæ¥ä»£è¡¨meta regionå¯ç”¨æ›´åˆé€‚ä¸€äº›ã€‚</p>
<p><img src="SCP.png" alt="SCPæµç¨‹å›¾"></p>
<ul>
<li>START: æ²¡æœ‰ä»€ä¹ˆå®é™…æ“ä½œï¼Œæ ¹æ®RSä¸Šæ˜¯å¦æœ‰metaè¡¨çš„regionï¼Œæ¥åˆ¤æ–­ä¸‹ä¸€æ­¥çš„çŠ¶æ€</li>
<li>SPLIT_META_LOGS: split metaè¡¨çš„WAL</li>
<li>DELETE_SPLIT_META_WALS_DIR: åˆ é™¤HDFSä¸Šmetaè¡¨split logçš„ç›®å½•</li>
<li>ASSIGN_META: é‡æ–°assign meta region</li>
<li>GET_REGIONS: æŸ¥è¯¢RSä¸Šé™¤metaå¤–çš„region</li>
<li>SPLIT_LOGS: splitémetaè¡¨çš„WAL</li>
<li>DELETE_SPLIT_WALS_DIR: åˆ é™¤HDFSä¸Šémetaè¡¨çš„WALç›®å½•</li>
<li>ASSIGN: assign émetaçš„region</li>
<li>FINISH: æ”¶å°¾å·¥ä½œï¼Œå°†RSåŠ åˆ° DeadServers listï¼Œè§¦å‘CP</li>
</ul>
<p>å…¶å®è¿™äº›çŠ¶æ€ä¸»è¦å¯ä»¥åšçš„å°±æ˜¯Split WALï¼ŒDelete WAL dirï¼ŒAssign regionè¿™ä¸‰ç±»ï¼Œåªä¸è¿‡å°†RegionæŒ‰æ˜¯å¦æ˜¯metaåšäº†åŒºåˆ†ï¼Œmeta regionå’Œæ™®é€šregionåˆ†åˆ«åšäº†è¿™ä¸‰ç±»æ“ä½œã€‚è¿™é‡Œæˆ‘ç†è§£åŸå› åº”è¯¥æ˜¯æ™®é€šçš„region assignéœ€è¦è¯»å†™metaè¡¨ï¼Œæ‰€ä»¥è¦æ±‚metaè¡¨çš„regionå¿…é¡»å¯ç”¨æ‰è¡Œï¼Œæ‰€ä»¥ä¼˜å…ˆå¯¹meta regionè¿›è¡Œä¸‰æ­¥æ“ä½œå¤„ç†ï¼Œmeta regionå¯ç”¨ä¹‹åæ‰ä¼šè¿›è¡Œæ™®é€šregionçš„ä¸‰æ­¥æ“ä½œã€‚</p>
<h3 id="é—®é¢˜">é—®é¢˜</h3>
<p><strong>æ‰§è¡ŒSCPçš„æ—¶å€™ï¼ŒRSä¸Šçš„regionæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</strong></p>
<p>ç›´æ¥ç½®ä¸ºABNORMALLY_CLOSEDï¼Œè®¤ä¸ºæ‰€æœ‰çš„regionéƒ½å·²ç»ä¸å¯ç”¨äº†ã€‚</p>
<p>å¦‚æœregionæœ‰TRSPåœ¨è¿›è¡Œï¼Œå°±è¿›ä¸€æ­¥é€šçŸ¥æ‰€æœ‰è¿™äº›regionçš„TRSPå’ŒRRPï¼Œåšå¯¹åº”çš„æ“ä½œã€‚<br>
å¦‚æœæ²¡æœ‰ï¼Œå°±æ–°åŠ TRSPå»assignè¿™äº›regionã€‚</p>
<p>å¦‚æœrså†æ¢å¤æˆ–å¯åŠ¨çš„è¯ï¼Œä¹Ÿåº”è¯¥ä¼šå‘ç°zkçš„èŠ‚ç‚¹ä¸¢äº†ï¼Œä¸èƒ½ç›´æ¥openå®ƒçš„regionã€‚ï¼ˆè¿™ä¸ªæ²¡æœ‰å»çœ‹ä»£ç ç¡®è®¤ï¼‰</p>
<h2 id="TransitRegionStateProcedure">TransitRegionStateProcedure</h2>
<h3 id="ä¸»è¦å˜é‡">ä¸»è¦å˜é‡</h3>
<p><strong>type/initialState/lastState</strong></p>
<table>
<thead>
<tr>
<th>type</th>
<th>initialState</th>
<th>lastState</th>
</tr>
</thead>
<tbody>
<tr>
<td>ASSIGN</td>
<td>GET_ASSIGN_CANDIDATE</td>
<td>CONFIRM_OPENED</td>
</tr>
<tr>
<td>UNASSIGN</td>
<td>CLOSE</td>
<td>CONFIRM_CLOSED</td>
</tr>
<tr>
<td>MOVE</td>
<td>CLOSE</td>
<td>CONFIRM_OPENED</td>
</tr>
<tr>
<td>REOPEN</td>
<td>CLOSE</td>
<td>CONFIRM_OPENED</td>
</tr>
</tbody>
</table>
<p><strong>remoteProc</strong></p>
<p>ç»‘å®šçš„æŸä¸ªRegionRemoteProcedureBaseï¼Œç”¨äºæ‰§è¡Œopen/close regionè¿™æ ·çš„RPCæ“ä½œï¼Œè¿™é‡Œä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªremoteProcï¼Œè¡¨ç¤ºä¸èƒ½åŒæ—¶è¿›è¡Œå¤šä¸ªæ“ä½œregionçŠ¶æ€çš„RPCã€‚</p>
<h3 id="çŠ¶æ€æµè½¬">çŠ¶æ€æµè½¬</h3>
<p><img src="TRSP-simple.png" alt="TRSPçŠ¶æ€ç®€å›¾"></p>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼ŒTRSPä¸­çš„5ä¸ªçŠ¶æ€å½¢æˆä¸€ä¸ªç¯ï¼Œé€šè¿‡initialStateå’ŒlastStateä¸¤ä¸ªçŠ¶æ€åˆ¤æ–­å…¥ç¯å’Œå‡ºç¯çš„çŠ¶æ€ã€‚</p>
<p>åƒASSIGNå’ŒUNASSIGNä¸¤ä¸ªæ“ä½œï¼Œåªéœ€è¦è·‘å®Œè‡ªå·±çš„çŠ¶æ€å°±è¡Œäº†ã€‚MOVE/REOPENæ“ä½œåˆ™è¦å…ˆcloseç„¶åopenï¼Œä¸åŒçš„æ˜¯ï¼Œé€šè¿‡æŒ‡å®šRegionStateNode.regionLocationæ¥æŒ‡å®šopenåœ¨å“ªä¸ªRSä¸Šï¼Œopençš„rså˜åŒ–äº†å°±æ˜¯MOVEï¼Œä¸å˜å°±æ˜¯REOPENã€‚</p>
<p>ASSIGN: GET_ASSIGN_CANDIDATE -&gt; OPEN -&gt; CONFIRM_OPENED<br>
UNASSIGN: CLOSE -&gt; CONFIRM_CLOSED<br>
MOVE/REOPEN: CLOSE -&gt; CONFIRM_CLOSE -&gt; GET_ASSIGN_CANDIDATE -&gt; OPEN -&gt; CONFIRM_OPENED</p>
<p>ç®€å›¾ä¸­ä¸€äº›å¼‚å¸¸æƒ…å†µä¸‹çš„çŠ¶æ€æµè½¬æ²¡æœ‰å±•ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚å¦‚æœcloseå¤±è´¥ï¼Œä¼šå†å°†region openï¼Œç„¶åå†closeï¼Œå°±ä¼šåœ¨ç¯ä¸Šè½¬åœˆã€‚å°±æ˜¯è¯´æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œå°±ä¼šåœ¨ç¯ä¸Šå¾ªç¯æ‰§è¡Œï¼Œç›´åˆ°æ»¡è¶³æ¡ä»¶è¾¾åˆ°lastStateæœ€ç»ˆå‡ºç¯ã€‚</p>
<p><img src="TRSP.png" alt="TRSPçŠ¶æ€å›¾"></p>
<p><strong>å‡†å¤‡å·¥ä½œ</strong></p>
<p>æ‰§è¡Œä¹‹å‰å¿…é¡»è·å–RegionStateNodeçš„é”ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå¤šæ¬¡å¯¹å…¶ä¸­çš„æ•°æ®ï¼ˆstateã€regionLocationï¼‰åšä¿®æ”¹ï¼Œå‰é¢è®²è¿‡ï¼Œä¸ºä¿è¯RegionStateNodeçš„å±æ€§ä¸ä¼šå¹¶å‘ä¿®æ”¹ï¼Œæ‰€æœ‰ä¿®æ”¹ä¹‹å‰éƒ½è¦å…ˆæ‹¿é”ã€‚</p>
<p><strong>GET_ASSIGN_CANDIDATE</strong></p>
<p>ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯ä¸ºRegionæŒ‡å®šä¸€ä¸ªRSï¼Œå°†Regionæ”¾å…¥AMçš„pendingAssignQueueä¹‹åï¼Œç›´æ¥suspendç­‰å¾…ã€‚AMä»¥ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ä¸ºRegionæŒ‡å®šRSï¼Œç„¶åå”¤é†’Procedureã€‚</p>
<p><strong>OPEN</strong></p>
<ol>
<li>å¦‚æœæ²¡æœ‰æŒ‡å®šregionLocationï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ä¸Šä¸€æ­¥GET_ASSIGN_CANDIDATEå‡ºç°é—®é¢˜ã€‚æˆ–è€…ä¸Šä¸€æ­¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒMasteré‡å¯ï¼ŒProcedureé‡è¯•æ‰§è¡Œäº†ã€‚è¿™æ—¶å€™é‡æ–°æ‰§è¡Œä¸Šä¸€æ­¥å°±å¥½äº†ã€‚</li>
<li>å¦‚æœæˆåŠŸåˆ¶å®šäº†regionLocationï¼Œå°±é€šè¿‡OpenRegionProcedureå»é€šçŸ¥RS openè¯¥regionã€‚
<ol>
<li>å¦‚æœOpenRegionProcedureæœ€ç»ˆæˆåŠŸæ‰§è¡Œå®Œäº†ï¼ŒTRSPç»§ç»­æ‰§è¡Œ</li>
<li>å¦‚æœå¤±è´¥äº†ï¼Œä¼šåœ¨ä¸‹ä¸€æ­¥CONFIRM_OPENEDè¿›è¡Œé‡è¯•</li>
<li>å¦‚æœMasteré‡å¯ï¼Œå¯¼è‡´æ— æ³•å”¤é†’ï¼ŒOpenRegionProcedureæœ‰è¶…æ—¶æœºåˆ¶ï¼Œè¶…æ—¶ä¹‹åä¼šå†é‡è¯•ã€‚</li>
</ol>
</li>
</ol>
<p><strong>CONFIRM_OPENED</strong></p>
<p>æ£€æŸ¥OPENæ“ä½œæœ€ç»ˆæ˜¯å¦æˆåŠŸã€‚</p>
<ol>
<li>å¦‚æœRegionæˆåŠŸOPEN
<ol>
<li>è¦çœ‹lastStateæ˜¯å¦å°±æ˜¯CONFIRM_OPENEDï¼Œæ˜¯çš„è¯å°±å®Œäº‹äº†ã€‚</li>
<li>ä¸æ˜¯çš„è¯è¦å†æ‰§è¡ŒCLOSEæ“ä½œã€‚å°±åƒç®€å›¾ä¸­çš„ç¯ä¸Šä¸€æ ·æ‰§è¡Œã€‚æœ‰å¯èƒ½å‡ºç°çš„ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“merge/split regionçš„æ—¶å€™ï¼Œè¦unassignä¸€ä¸ªregionï¼Œä½†è¿‡ç¨‹ä¸­RS crashäº†ï¼Œå°±å¾—å…ˆæŠŠè¿™ä¸ªregion openäº†ï¼Œå†æ‰§è¡Œunassignæ“ä½œï¼Œé˜²æ­¢RS crashæ—¶æ•°æ®ä¸¢å¤±æ— æ³•æ¢å¤ã€‚</li>
</ol>
</li>
<li>é‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œç›´æ¥ç»“æŸ</li>
<li>æŠ¹æ‰regionLocationï¼Œé‡æ–°æ‰§è¡ŒGET_ASSIGN_CANDIDATE</li>
</ol>
<p><strong>CLOSE</strong></p>
<ol>
<li>regionå½“å‰çš„çŠ¶æ€åˆç†ï¼Œé€šè¿‡CloseRegionProcedureï¼Œæ‰§è¡Œè¿‡ç¨‹ç±»ä¼¼äºOpenRegionProcedureã€‚</li>
<li>ä¸åˆç†ç›´æ¥å†å»GET_ASSIGN_CANDIDATEèµ°OPENçš„é€»è¾‘</li>
</ol>
<p><strong>CONFIRM_CLOSED</strong></p>
<ol>
<li>å¦‚æœRegionå½“å‰çŠ¶æ€æ˜¯CLOSEï¼Œè¯´æ˜ä¸Šä¸€æ­¥æ‰§è¡ŒæˆåŠŸäº†
<ol>
<li>å¦‚æœlastState == CONFIRM_CLOSEDï¼Œè¯´æ˜å½“å‰çŠ¶æ€å°±æ˜¯è¦æ±‚çš„æœ€ç»ˆçŠ¶æ€ï¼Œå¯ä»¥ç»“æŸäº†ã€‚</li>
<li>å¦åˆ™ï¼Œè¯´æ˜å¯èƒ½æ˜¯moveæˆ–è€…reopenæ“ä½œï¼Œéœ€è¦å†assign regionï¼Œå»GET_ASSIGN_CANDIDATEèµ°OPENçš„é€»è¾‘ã€‚<strong>åªæœ‰è¿™ä¸€ä¸ªåœ°æ–¹å›åˆ°GET_ASSIGN_CANDIDATEæ²¡æœ‰æŠ¹æ‰regionLocation</strong>ã€‚</li>
</ol>
</li>
<li>å¦‚æœRegionå½“å‰çŠ¶æ€æ˜¯CLOSINGï¼Œè¯´æ˜close rpcæ‰§è¡Œå¤±è´¥äº†ï¼Œrsæ²¡æœ‰å›è°ƒé€šçŸ¥ï¼ˆeg. rsé‡å¯äº†ï¼‰ï¼Œä¸€ç›´ç­‰åˆ°äº†CloseRegionProcedureè¶…æ—¶è§¦å‘äº†TRSPç»§ç»­æ‰§è¡Œï¼Œæ‰èµ°åˆ°äº†å½“å‰çŠ¶æ€ï¼Œéœ€è¦å†é‡æ–°Closeä¸€æ¬¡ã€‚</li>
<li>èµ°åˆ°è¿™é‡Œçš„Regionå¯èƒ½æ˜¯ABNORMALLY_CLOSEDçŠ¶æ€ï¼Œåº”è¯¥åªæœ‰RS crashæ‰ä¼šå¯¼è‡´è¿™ä¸ªçŠ¶æ€ã€‚
<ol>
<li>å¦‚æœédefault regionï¼ŒABNORMALLY_CLOSEDå¯ä»¥è¢«å½“ä½œCLOSEå¤„ç†ï¼Œç›´æ¥ç»“æŸæ‰ã€‚åªæœ‰å¼€å¯äº†read region replicasåŠŸèƒ½æ‰æœ‰è¿™æ ·çš„regionã€‚édefault regionä¸æ¥æ”¶å†™æ“ä½œï¼Œæ‰€ä»¥å³ä½¿éæ­£å¸¸closeä¹Ÿä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚</li>
<li>Region closeå¼‚å¸¸ï¼Œéœ€è¦å†openä¹‹åå†æ­£å¸¸closeï¼Œä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚åŸå› å’ŒCONFIRM_OPENEDé‡Œçš„é€»è¾‘ç±»ä¼¼ï¼Œæ¯”å¦‚merge/split regionçš„æ—¶å€™ï¼Œè¦å…ˆclose regionï¼Œå¦‚æœå¤±è´¥äº†ï¼Œåˆ™å¿…é¡»å…ˆæ¢å¤regionå†é‡æ–°closeï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚</li>
</ol>
</li>
</ol>
<h3 id="é—®é¢˜-v2">é—®é¢˜</h3>
<p><strong>region merge/splitæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</strong></p>
<p>region merge/splitåˆ†åˆ«æ˜¯ç”±MergeTableRegionsProcedureå’ŒSplitTableRegionProcedureæ¥æ‰§è¡Œçš„ï¼Œå®ƒä»¬æ­¥æ­¥éª¤éƒ½å¯ä»¥æ‹†åˆ†æˆregion assign/unassignï¼Œä¹Ÿå°±ä¼šæ‹†æˆä¸åŒçš„TRSPå»æ‰§è¡Œã€‚</p>
<p>ä»¥ region splitä¸ºä¾‹</p>
<ol>
<li>closeçˆ¶regionï¼ˆunassignï¼‰</li>
<li>å¤„ç†å¥½å­regionçš„ä¿¡æ¯ä¿å­˜ä¹‹å</li>
<li>openå­regionï¼ˆassignï¼‰</li>
</ol>
<h3 id="RegionRemoteProcedureBase">RegionRemoteProcedureBase</h3>
<p>RegionRemoteProcedureBaseæ˜¯OpenRegionProcedureå’ŒCloseRegionProcedureçš„çˆ¶ç±»ï¼Œå®ç°äº†åŸºæœ¬çš„RPCç›¸å…³åŠŸèƒ½ã€‚RegionRemoteProcedureBaseä¸TRSPçš„é…åˆä¸»è¦ä¹Ÿæ˜¯åˆ©ç”¨äº†ProcedureEventæœºåˆ¶ã€‚</p>
<p><img src="RegionRemoteProcedureBase.png" alt="RegionRemoteProcedureBaseæ—¶åºå›¾"></p>
<ol>
<li>addOperationToNodeæ–¹æ³•å°±æ˜¯å°†RPCæ“ä½œå°è£…èµ·æ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­ç­‰å¾…æ‰§è¡Œã€‚</li>
<li>æ‰§è¡Œå½“å‰Regionçš„ProcedureEvent.suspendæ“ä½œï¼Œç­‰å¾…RPCæ‰§è¡Œå®Œæ¯•ä¹‹åå”¤é†’ã€‚</li>
<li>RSProcedureDispatcherä¼šåˆ†æ‰¹å°†RPCæ“ä½œæŒ‰RSå’Œæ“ä½œç±»å‹åˆ†ç±»ï¼Œæ‰¹é‡è¯·æ±‚æŸä¸ªRSã€‚</li>
<li>RSæ‰§è¡Œå®Œå¯¹åº”æ“ä½œä¹‹åï¼Œé€šè¿‡reportTransitioné€šçŸ¥AMï¼ˆå½“ç„¶ä¸­é—´è¿˜æœ‰Masterï¼‰ï¼ŒRegion open/closeå®Œæˆã€‚</li>
<li>ç„¶åAMå°±ä¼šå”¤é†’RegionStateNode.eventï¼Œç»§ç»­æ‰§è¡ŒRegionRemoteProcedureBase</li>
<li>RegionRemoteProcedureBaseæ‰§è¡Œå®Œæˆä¹‹åï¼Œç»§ç»­æ‰§è¡ŒTRSPåç»­æ­¥éª¤ã€‚</li>
</ol>
<h4 id="é—®é¢˜-v3">é—®é¢˜</h4>
<p><strong>RPCå›è°ƒä¹‹åï¼Œæ€ä¹ˆç¡®å®šå¯¹åº”çš„å“ªä¸ªProcedureï¼Ÿ</strong></p>
<p>RegionInfo -&gt; AM.regionStates (ç±»å‹ RegionStates) -&gt; RegionStates.regionMap (ç±»å‹ Map&lt;byte[], RegionStateNode&gt;) -&gt; RegionStateNode.procedure (ç±»å‹ TRSP) -&gt; TRSP.remoteProc (ç±»å‹ RegionRemoteProcedureBase) -&gt; RegionRemoteProcedureBase.reportTransition</p>
<p><strong>RSé‡å¯å¯¼è‡´æ²¡æœ‰RPCå›è°ƒï¼Œæˆ–è€…Masteré‡å¯ä¹‹åeventé˜Ÿåˆ—ä¸¢å¤± æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>RegionRemoteProcedureBaseæœ‰ä¸ªè¶…æ—¶é™åˆ¶ï¼Œè¶…æ—¶ä¹‹åé‡æ–°å†æ‰§è¡Œä¸€æ¬¡ã€‚</p>
]]></content>
      <categories>
        <category>HBase</category>
      </categories>
      <tags>
        <tag>HBase</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŒTEDã€Listening to shame</title>
    <url>/blog/2020/03/23/TED-Listening-to-shame/</url>
    <content><![CDATA[<p><a href="https://www.ted.com/talks/brene_brown_listening_to_shame" target="_blank" rel="noopener">TEDè§†é¢‘é“¾æ¥</a></p>
<a id="more"></a>

<p>Iâ€™m going to tell you a little bit about my TEDxHouston Talk. I woke up the morning after I gave that talk with the worst vulnerability hangover of my life. And I actually didnâ€™t leave my house for about three days.</p>
<blockquote>
<p><a href="https://fanyi.baidu.com/#en/zh/vulnerability" target="_blank" rel="noopener">vulnerability</a>  [ËŒvÊŒlnÉ™rÉ™â€™bÉªlÉ™ti]<br>n. å¼±ç‚¹;è„†å¼±æ€§;æ˜“ä¼¤æ€§;å¯æ•æ€§</p>
</blockquote>
<blockquote>
<p><a href="https://fanyi.baidu.com/#en/zh/hangover" target="_blank" rel="noopener">hangover</a>  [ËˆhÃ¦Å‹oÊŠvÉ™r]<br>n. å®¿é†‰;é—ç•™çš„æ„Ÿè§‰;æ²¿è¢­ä¸‹æ¥çš„é£ä¿—(æˆ–æ€æƒ³ç­‰)</p>
</blockquote>
<p>The first time I left was to meet a friend for lunch. And when I walked in, she was already at the table. I sat down, and she said, â€œGod, you look like hell.â€ I said, â€œThanks. I feel really â€“ Iâ€™m not functioning.â€ And she said, â€œWhatâ€™s going on?â€ And I said, â€œI just told 500 people that I became a researcher to avoid vulnerability. And that when being vulnerable emerged from my data, as absolutely essential to whole-hearted living, I told these 500 people that I had a breakdown. I had a slide that said â€˜Breakdown.â€™ At what point did I think that was a good idea?â€</p>
<blockquote>
<p>emerge from  [iËˆmÉœËrdÊ’ frÉ™m]<br>ï¼ˆä»â€¦ï¼‰éœ²å‡ºï¼Œæµ®ç°;ã€ˆæ­£ã€‰æ¥è‡ªï¼Œäº§ç”Ÿäºï¼Œè„±ç¦»<br>emerge from my data æˆ‘çš„æ•°æ®è¡¨æ˜</p>
</blockquote>
<blockquote>
<p>essential [ÉªËˆsenÊƒl]<br>adj. å®Œå…¨å¿…è¦çš„;å¿…ä¸å¯å°‘çš„;æå…¶é‡è¦çš„;æœ¬è´¨çš„;åŸºæœ¬çš„;æ ¹æœ¬çš„<br>n. å¿…ä¸å¯å°‘çš„ä¸œè¥¿;å¿…éœ€å“;è¦ç‚¹;è¦ç´ ;å®è´¨  </p>
</blockquote>
<blockquote>
<p>slideshow  å¹»ç¯ç‰‡<br>make a slideshow, slideç†è§£ä¸ºä¸€å¼ å¹»ç¯ç‰‡</p>
</blockquote>
<p>(Laughter)</p>
<p>And she said, â€œI saw your talk live-streamed. It was not really you. It was a little different than what you usually do. But it was great.â€ And I said, â€œThis canâ€™t happen. YouTube, theyâ€™re putting this thing on YouTube. And weâ€™re going to be talking about 600, 700 people.â€</p>
<blockquote>
<p>live-streamed ç›´æ’­</p>
</blockquote>
<p>(Laughter)</p>
<p>And she said, â€œWell, I think itâ€™s too late.â€</p>
<p>And I said, â€œLet me ask you something.â€ And she said, â€œYeah.â€ I said, â€œDo you remember when we were in college, really wild and kind of dumb?â€ She said, â€œYeah.â€ I said, â€œRemember when weâ€™d leave a really bad message on our ex-boyfriendâ€™s answering machine? Then weâ€™d have to break into his dorm room and then erase the tape?â€</p>
<p>(Laughter)</p>
<p>And she goes, â€œUhâ€¦ no.â€</p>
<p>(Laughter)</p>
<p>Of course, the only thing I could say at that point was, â€œYeah, me neither. Yeah â€“ me neither.â€</p>
<p>And Iâ€™m thinking to myself, â€œBrenÃ©, what are you doing? Why did you bring this up? Have you lost your mind? Your sisters would be perfect for this.â€</p>
<p>(Laughter)</p>
<p>So I looked back up and she said, â€œAre you really going to try to break in and steal the video before they put it on YouTube?â€</p>
<p>(Laughter)</p>
<p>And I said, â€œIâ€™m just thinking about it a little bit.â€</p>
<p>(Laughter)</p>
<p>She said, â€œYouâ€™re like the worst vulnerability role model ever.â€</p>
<p>(Laughter)</p>
<p>Then I looked at her and I said something that at the time felt a little dramatic, but ended up being more prophetic than dramatic. â€œIf 500 turns into 1,000 or 2,000, my life is over.â€</p>
<p>(Laughter)</p>
<p>I had no contingency plan for four million.</p>
<blockquote>
<p>contingency [kÉ™nËˆtÉªndÊ’É™nsi] plan åº”æ€¥æ–¹æ¡ˆ</p>
</blockquote>
<p>(Laughter)</p>
<p>And my life did end when that happened. And maybe the hardest part about my life ending is that I learned something hard about myself, and that was that, as much as I would be frustrated about not being able to get my work out to the world, there was a part of me that was working very hard to engineer staying small, staying right under the radar. But I want to talk about what Iâ€™ve learned.</p>
<p>Thereâ€™s two things that Iâ€™ve learned in the last year. The first is: vulnerability is not weakness. And that myth is profoundly dangerous. Let me ask you honestly â€“ and Iâ€™ll give you this warning, Iâ€™m trained as a therapist, so I can out-wait you uncomfortably â€“ so if you could just raise your hand that would be awesome â€“ how many of you honestly, when youâ€™re thinking about doing or saying something vulnerable think, â€œGod, vulnerability is weakness.â€ How many of you think of vulnerability and weakness synonymously? The majority of people. Now let me ask you this question: This past week at TED, how many of you, when you saw vulnerability up here, thought it was pure courage? Vulnerability is not weakness. I define vulnerability as emotional risk, exposure, uncertainty. It fuels our daily lives. And Iâ€™ve come to the belief â€“ this is my 12th year doing this research â€“ that vulnerability is our most accurate measurement of courage â€“ to be vulnerable, to let ourselves be seen, to be honest.</p>
<p>One of the weird things thatâ€™s happened is, after the TED explosion, I got a lot of offers to speak all over the country â€“ everyone from schools and parent meetings to Fortune 500 companies. And so many of the calls went like this, â€œDr. Brown, we loved your TED talk. Weâ€™d like you to come in and speak. Weâ€™d appreciate it if you wouldnâ€™t mention vulnerability or shame.â€</p>
<p>(Laughter)</p>
<p>What would you like for me to talk about? Thereâ€™s three big answers. This is mostly, to be honest with you, from the business sector: innovation, creativity and change.</p>
<p>(Laughter)</p>
<p>So let me go on the record and say, vulnerability is the birthplace of innovation, creativity and change.</p>
<p>(Applause)</p>
<p>To create is to make something that has never existed before. Thereâ€™s nothing more vulnerable than that. Adaptability to change is all about vulnerability.</p>
<p>The second thing, in addition to really finally understanding the relationship between vulnerability and courage, the second thing I learned, is this: We have to talk about shame. And Iâ€™m going to be really honest with you. When I became a â€œvulnerability researcherâ€ and that became the focus because of the TED talk â€“ and Iâ€™m not kidding.</p>
<p>Iâ€™ll give you an example. About three months ago, I was in a sporting goods store buying goggles and shin guards and all the things that parents buy at the sporting goods store. About from a hundred feet away, this is what I hear: â€œVulnerability TED! Vulnerability TED!â€</p>
<p>(Laughter)</p>
<p>(Laughter ends)</p>
<p>Iâ€™m a fifth-generation Texan. Our family motto is â€œLock and load.â€ I am not a natural vulnerability researcher. So Iâ€™m like, just keep walking, sheâ€™s on my six.</p>
<p>(Laughter)</p>
<p>And then I hear, â€œVulnerability TED!â€ I turn around, I go, â€œHi.â€ Sheâ€™s right here and she said, â€œYouâ€™re the shame researcher who had the breakdown.â€</p>
<p>(Laughter)</p>
<p>At this point, parents are, like, pulling their children close.</p>
<p>(Laughter)</p>
<p>â€œLook away.â€ And Iâ€™m so worn out at this point in my life, I look at her and I actually say, â€œIt was a fricking spiritual awakening.â€</p>
<p>(Laughter)</p>
<p>(Applause)</p>
<p>And she looks back and does this, â€œI know.â€</p>
<p>(Laughter)</p>
<p>And she said, â€œWe watched your TED talk in my book club. Then we read your book and we renamed ourselves â€˜The Breakdown Babes.â€™â€</p>
<p>(Laughter)</p>
<p>And she said, â€œOur tagline is: â€˜Weâ€™re falling apart and it feels fantastic.â€™â€</p>
<p>(Laughter)</p>
<p>You can only imagine what itâ€™s like for me in a faculty meeting.</p>
<p>(Sighs)</p>
<p>So when I became Vulnerability TED, like an action figure â€“ Like Ninja Barbie, but Iâ€™m Vulnerability TED â€“ I thought, Iâ€™m going to leave that shame stuff behind, because I spent six years studying shame before I started writing and talking about vulnerability. And I thought, thank God, because shame is this horrible topic, no one wants to talk about it. Itâ€™s the best way to shut people down on an airplane. â€œWhat do you do?â€ â€œI study shame.â€ â€œOh.â€</p>
<p>(Laughter)</p>
<p>And I see you.</p>
<p>(Laughter)</p>
<p>But in surviving this last year, I was reminded of a cardinal rule â€“ not a research rule, but a moral imperative from my upbringing â€“ â€œyouâ€™ve got to dance with the one who brung yaâ€. And I did not learn about vulnerability and courage and creativity and innovation from studying vulnerability. I learned about these things from studying shame. And so I want to walk you in to shame. Jungian analysts call shame the swampland of the soul. And weâ€™re going to walk in. And the purpose is not to walk in and construct a home and live there. It is to put on some galoshes â€“ and walk through and find our way around. Hereâ€™s why.</p>
<p>We heard the most compelling call ever to have a conversation in this country, and I think globally, around race, right? Yes? We heard that. Yes? Cannot have that conversation without shame. Because you cannot talk about race without talking about privilege. And when people start talking about privilege, they get paralyzed by shame. We heard a brilliant simple solution to not killing people in surgery, which is, have a checklist. You canâ€™t fix that problem without addressing shame, because when they teach those folks how to suture, they also teach them how to stitch their self-worth to being all-powerful. And all-powerful folks donâ€™t need checklists.</p>
<p>And I had to write down the name of this TED Fellow so I didnâ€™t mess it up here. Myshkin Ingawale, I hope I did right by you.</p>
<p>(Applause)</p>
<p>I saw the TED Fellows my first day here. And he got up and he explained how he was driven to create some technology to help test for anemia, because people were dying unnecessarily. And he said, â€œI saw this need. So you know what I did? I made it.â€ And everybody just burst into applause, and they were like â€œYes!â€ And he said, â€œAnd it didnâ€™t work.</p>
<p>(Laughter)</p>
<p>And then I made it 32 more times, and then it worked.â€</p>
<p>You know what the big secret about TED is? I canâ€™t wait to tell people this. I guess Iâ€™m doing it right now.</p>
<p>(Laughter)</p>
<p>This is like the failure conference.</p>
<p>(Laughter)</p>
<p>No, it is.</p>
<p>(Applause)</p>
<p>You know why this place is amazing? Because very few people here are afraid to fail. And no one who gets on the stage, so far that Iâ€™ve seen, has not failed. Iâ€™ve failed miserably, many times. I donâ€™t think the world understands that, because of shame.</p>
<p>Thereâ€™s a great quote that saved me this past year by Theodore Roosevelt. A lot of people refer to it as the â€œMan in the Arenaâ€ quote. And it goes like this: â€œIt is not the critic who counts. It is not the man who sits and points out how the doer of deeds could have done things better and how he falls and stumbles. The credit goes to the man in the arena whose face is marred with dust and blood and sweat. But when heâ€™s in the arena, at best, he wins, and at worst, he loses, but when he fails, when he loses, he does so daring greatly.â€</p>
<p>And thatâ€™s what this conference, to me, is about. Life is about daring greatly, about being in the arena. When you walk up to that arena and you put your hand on the door, and you think, â€œIâ€™m going in and Iâ€™m going to try this,â€ shame is the gremlin who says, â€œUh, uh. Youâ€™re not good enough. You never finished that MBA. Your wife left you. I know your dad really wasnâ€™t in Luxembourg, he was in Sing Sing. I know those things that happened to you growing up. I know you donâ€™t think that youâ€™re pretty, smart, talented or powerful enough. I know your dad never paid attention, even when you made CFO.â€ Shame is that thing.</p>
<p>And if we can quiet it down and walk in and say, â€œIâ€™m going to do this,â€ we look up and the critic that we see pointing and laughing, 99 percent of the time is who? Us. Shame drives two big tapes â€“ â€œnever good enoughâ€ â€“ and, if you can talk it out of that one, â€œwho do you think you are?â€ The thing to understand about shame is, itâ€™s not guilt. Shame is a focus on self, guilt is a focus on behavior. Shame is â€œI am bad.â€ Guilt is â€œI did something bad.â€ How many of you, if you did something that was hurtful to me, would be willing to say, â€œIâ€™m sorry. I made a mistake?â€ How many of you would be willing to say that? Guilt: Iâ€™m sorry. I made a mistake. Shame: Iâ€™m sorry. I am a mistake.</p>
<p>Thereâ€™s a huge difference between shame and guilt. And hereâ€™s what you need to know. Shame is highly, highly correlated with addiction, depression, violence, aggression, bullying, suicide, eating disorders. And hereâ€™s what you even need to know more. Guilt, inversely correlated with those things. The ability to hold something weâ€™ve done or failed to do up against who we want to be is incredibly adaptive. Itâ€™s uncomfortable, but itâ€™s adaptive.</p>
<p>The other thing you need to know about shame is itâ€™s absolutely organized by gender. If shame washes over me and washes over Chris, itâ€™s going to feel the same. Everyone sitting in here knows the warm wash of shame. Weâ€™re pretty sure that the only people who donâ€™t experience shame are people who have no capacity for connection or empathy. Which means, yes, I have a little shame; no, Iâ€™m a sociopath. So I would opt for, yes, you have a little shame. Shame feels the same for men and women, but itâ€™s organized by gender.</p>
<p>For women, the best example I can give you is Enjoli, the commercial. â€œI can put the wash on the line, pack the lunches, hand out the kisses and be at work at five to nine. I can bring home the bacon, fry it up in the pan and never let you forget youâ€™re a man.â€ For women, shame is, do it all, do it perfectly and never let them see you sweat. I donâ€™t know how much perfume that commercial sold, but I guarantee you, it moved a lot of antidepressants and anti-anxiety meds.</p>
<p>(Laughter)</p>
<p>Shame, for women, is this web of unobtainable, conflicting, competing expectations about who weâ€™re supposed to be. And itâ€™s a straight-jacket.</p>
<p>For men, shame is not a bunch of competing, conflicting expectations. Shame is one, do not be perceived as what? Weak. I did not interview men for the first four years of my study. It wasnâ€™t until a man looked at me after a book signing, and said, â€œI love what say about shame, Iâ€™m curious why you didnâ€™t mention men.â€ And I said, â€œI donâ€™t study men.â€ And he said, â€œThatâ€™s convenient.â€</p>
<p>(Laughter)</p>
<p>And I said, â€œWhy?â€ And he said, â€œBecause you say to reach out, tell our story, be vulnerable. But you see those books you just signed for my wife and my three daughters?â€ I said, â€œYeah.â€ â€œTheyâ€™d rather me die on top of my white horse than watch me fall down. When we reach out and be vulnerable, we get the shit beat out of us. And donâ€™t tell me itâ€™s from the guys and the coaches and the dads. Because the women in my life are harder on me than anyone else.â€</p>
<p>So I started interviewing men and asking questions. And what I learned is this: You show me a woman who can actually sit with a man in real vulnerability and fear, Iâ€™ll show you a woman whoâ€™s done incredible work. You show me a man who can sit with a woman whoâ€™s just had it, she canâ€™t do it all anymore, and his first response is not, â€œI unloaded the dishwasher!â€</p>
<p>(Laughter)</p>
<p>But he really listens â€“ because thatâ€™s all we need â€“ Iâ€™ll show you a guy whoâ€™s done a lot of work.</p>
<p>Shame is an epidemic in our culture. And to get out from underneath it â€“ to find our way back to each other, we have to understand how it affects us and how it affects the way weâ€™re parenting, the way weâ€™re working, the way weâ€™re looking at each other. Very quickly, some research by Mahalik at Boston College. He asked, what do women need to do to conform to female norms? The top answers in this country: nice, thin, modest and use all available resources for appearance.</p>
<p>(Laughter)</p>
<p>When he asked about men, what do men in this country need to do to conform with male norms, the answers were: always show emotional control, work is first, pursue status and violence.</p>
<p>If weâ€™re going to find our way back to each other, we have to understand and know empathy, because empathyâ€™s the antidote to shame. If you put shame in a Petri dish, it needs three things to grow exponentially: secrecy, silence and judgment. If you put the same amount in a Petri dish and douse it with empathy, it canâ€™t survive. The two most powerful words when weâ€™re in struggle: me too.</p>
<p>And so Iâ€™ll leave you with this thought. If weâ€™re going to find our way back to each other, vulnerability is going to be that path. And I know itâ€™s seductive to stand outside the arena, because I think I did it my whole life, and think to myself, Iâ€™m going to go in there and kick some ass when Iâ€™m bulletproof and when Iâ€™m perfect. And that is seductive. But the truth is, that never happens. And even if you got as perfect as you could and as bulletproof as you could possibly muster when you got in there, thatâ€™s not what we want to see. We want you to go in. We want to be with you and across from you. And we just want, for ourselves and the people we care about and the people we work with, to dare greatly.</p>
<p>So thank you all very much. I really appreciate it.</p>
<p>(Applause)</p>
]]></content>
      <categories>
        <category>English</category>
      </categories>
      <tags>
        <tag>TED</tag>
        <tag>English</tag>
      </tags>
  </entry>
  <entry>
    <title>HBaseä¸åœæœè·¨é›†ç¾¤æ•°æ®è¿ç§»</title>
    <url>/blog/2020/03/14/HBase%E4%B8%8D%E5%81%9C%E6%9C%8D%E8%B7%A8%E9%9B%86%E7%BE%A4%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/</url>
    <content><![CDATA[<p>æœ€è¿‘æ¥åˆ°ä¸¤ä¸ªç”¨æˆ·æçš„JIRAï¼Œéƒ½æ˜¯ç›®å‰æ•°æ®åªå­˜åœ¨äº†ä¸€ä¸ªsrvé›†ç¾¤ï¼Œéœ€è¦å°†æ•°æ®å¤‡ä»½prcé›†ç¾¤åšæ•°æ®å¤‡ä»½æˆ–è€…ç¦»çº¿è®¡ç®—ï¼ŒåŒæ—¶ä¸¤é›†ç¾¤ä¹‹é—´è¿˜è¦åšæ•°æ®å®æ—¶åŒæ­¥ã€‚æ‰€ä»¥åœ¨è¿™é‡Œè®°å½•ä¸‹æ“ä½œè¿‡ç¨‹å¹¶ä»‹ç»ä¸‹åŸå› ã€‚</p>
<a id="more"></a>

<p>é›†ç¾¤ä¹‹é—´å¢é‡æ•°æ®åŒæ­¥è‡ªç„¶æ˜¯åˆ©ç”¨replicationï¼Œå•å‘åŒæ­¥é…ç½®ä¸€ä¸ªpeerï¼ŒåŒå‘åŒæ­¥é…ç½®ä¸¤ä¸ªpeerå°±å¥½ã€‚</p>
<p>å­˜é‡æ•°æ®ä½¿ç”¨snapshotåŒæ­¥ã€‚</p>
<h2 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h2><p><strong>0. å‡†å¤‡å·¥ä½œ</strong></p>
<p>åœ¨prcé›†ç¾¤æ–°å»ºnamespace</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create_namespace &#39;ns&#39;</span><br></pre></td></tr></table></figure>

<p><strong>1. æ–°å»ºsrvåˆ°prcé›†ç¾¤çš„peer</strong></p>
<p><strong>æ³¨æ„peerè¦disableæ‰</strong></p>
<p>å¦‚æœä¹‹å‰æ²¡æœ‰srvåˆ°prcé›†ç¾¤çš„peerï¼Œç›´æ¥æ–°å»ºpeer</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; å¤åˆ¶namespace</span><br><span class="line">add_peer &#39;1&#39;, CLUSTER_KEY &#x3D;&gt; &quot;zk1,zk2,zk3:11000:&#x2F;hbase&#x2F;prc&quot;, STATE &#x3D;&gt; &quot;DISABLED&quot;, NAMESPACES &#x3D;&gt; [&quot;ns&quot;]</span><br><span class="line">&#x2F;&#x2F; å¤åˆ¶table</span><br><span class="line">add_peer &#39;1&#39;, CLUSTER_KEY &#x3D;&gt; &quot;zk1,zk2,zk3:11000:&#x2F;hbase&#x2F;prc&quot;, STATE &#x3D;&gt; &quot;DISABLED&quot;, TABLE_CFS &#x3D;&gt; &#123; &quot;ns:table1&quot; &#x3D;&gt; [] &#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¹‹å‰å·²ç»æœ‰srvåˆ°prcé›†ç¾¤çš„peerï¼Œåœ¨peerä¸­åŠ å…¥è¦æ“ä½œçš„namespace</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">disable_peer &#39;1&#39;</span><br><span class="line">&#x2F;&#x2F; æ–°åŠ namespace</span><br><span class="line">append_peer_namespaces &#39;1&#39;, [&quot;ns&quot;]</span><br><span class="line">&#x2F;&#x2F; æ–°åŠ table</span><br><span class="line">append_peer_tableCFs &#39;1&#39;, &#123; &quot;ns:table1&quot; &#x3D;&gt; []&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. æ‰“snapshot</strong></p>
<p>å°†è¦åŒæ­¥çš„è¡¨æ‰“snapshotï¼Œå¦‚æœå¤åˆ¶æ•´ä¸ªnamespaceï¼Œè¦ä¸€ä¸ªä¸€ä¸ªæ‰“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">snapshot &#39;ns:table1&#39;, &#39;ns_table1_snapshot&#39;</span><br></pre></td></tr></table></figure>

<p><strong>3. å°†snapshotå¤åˆ¶åˆ°prcé›†ç¾¤</strong></p>
<p>ä½¿ç”¨<code>ExportSnapshot</code>å°†snapshotä»srvå¤åˆ¶åˆ°prcé›†ç¾¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;hbase --config &#x2F;path&#x2F;to&#x2F;conf org.apache.hadoop.hbase.snapshot.ExportSnapshot -copy-from hdfs:&#x2F;&#x2F;srv&#x2F;hbase&#x2F;srv -copy-to hdfs:&#x2F;&#x2F;prc&#x2F;hbase&#x2F;prc -snapshot ns_table1_snapshot -mappers 100 -bandwidth 512 -overwrite &gt;&gt; copy.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p><strong>4. åœ¨prcé›†ç¾¤ä½¿ç”¨snapshotç”Ÿæˆè¡¨</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">clone_snapshot &#39;ns_table1_snapshot&#39;, &#39;ns:table1&#39;</span><br></pre></td></tr></table></figure>

<p><strong>5. å¼€å¯peer</strong></p>
<p>å°†srvåˆ°prcé›†ç¾¤çš„peeræ‰“å¼€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">enable_peer &#39;1&#39;</span><br></pre></td></tr></table></figure>

<p><strong>6. å…¶ä»–</strong></p>
<p>åœ¨peeré›†ç¾¤åŠ æƒé™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grant &#39;kerberos_name&#39;, &#39;RW&#39;, &#39;@ns1&#39;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦ä¿©é›†ç¾¤åŒå‘åŒæ­¥ï¼Œåœ¨å¢åŠ prcåˆ°srvé›†ç¾¤çš„peer</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">add_peer &#39;2&#39;, CLUSTER_KEY &#x3D;&gt; &quot;zk1,zk2,zk3:11000:&#x2F;hbase&#x2F;srv&quot;, STATE &#x3D;&gt; &quot;ENABLED&quot;, NAMESPACES &#x3D;&gt; [&quot;ns&quot;]</span><br></pre></td></tr></table></figure>

<h2 id="æ“ä½œåŸå› "><a href="#æ“ä½œåŸå› " class="headerlink" title="æ“ä½œåŸå› "></a>æ“ä½œåŸå› </h2><p>æ•°æ®å¤åˆ¶è‡ªç„¶ä¸èƒ½ä¸¢æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¦ä¿è¯snapshotçš„å­˜é‡æ•°æ®å’Œreplicationçš„å¢é‡æ•°æ®ä¹‹é—´ä¸èƒ½æœ‰é—´éš™ï¼Œä½†å…¶å®å¯ä»¥æœ‰é‡å ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ–°å»ºreplication peerï¼Œå°†ç°æœ‰çš„WALå’Œä¹‹åå†ç”Ÿæˆçš„WALéƒ½åŠ è¿›è¯¥peerçš„å¤åˆ¶é˜Ÿåˆ—ä¸­ï¼Œdisableæ‰peerçš„åŸå› åˆ™æ˜¯prcé›†ç¾¤è¿˜æ²¡æœ‰æ–°å»ºè¡¨ï¼Œreplicationå¼€å§‹å¤åˆ¶åˆ™ä¼šå‡ºç°<code>Table xxx does not exist</code>çš„æŠ¥é”™ã€‚è¿™ä¸€æ­¥å¦‚æœæ˜¯ä¿®æ”¹çš„åŸæœ‰peerï¼Œåˆ™ä¼šå¯¼è‡´replicationå»¶è¿Ÿå¢åŠ ã€‚</p>
<p>ä¹‹åå†æ‰“snapshotä¾¿ä¸ç”¨æ‹…å¿ƒæ•°æ®æœ‰ä¸¢å¤±äº†ï¼Œæ­¤æ—¶replicationçš„æ•°æ®ä¸snapshotçš„æ•°æ®å·²ç»æœ‰é‡å äº†ã€‚</p>
<p>æœ€åæ€»ç»“ä¸€å¥ï¼Œä¸€å®šè¦å…ˆæ–°å»ºreplication peerï¼Œç„¶ååœ¨æ‰“snapshotã€‚</p>
]]></content>
      <categories>
        <category>HBase</category>
      </categories>
      <tags>
        <tag>HBase</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL å­¦ä¹ ç¬”è®° Day3ï¼šMySQLäº‹åŠ¡éš”ç¦»</title>
    <url>/blog/2020/01/26/MySQL-notes-Day3/</url>
    <content><![CDATA[<p>æå®¢æ—¶é—´MySQLå®æˆ˜45è®² <a href="https://time.geekbang.org/column/article/68963" target="_blank" rel="noopener">03 | äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿ</a> å­¦ä¹ ç¬”è®°</p>
<a id="more"></a>

<h3 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h3><table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>æè¿°</th>
<th>ä¸»è¦é—®é¢˜</th>
</tr>
</thead>
<tbody><tr>
<td>è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰</td>
<td>ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°</td>
<td>è„è¯»</td>
</tr>
<tr>
<td>è¯»æäº¤ï¼ˆRead Committedï¼‰</td>
<td>ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°</td>
<td>ä¸å¯é‡å¤è¯»</td>
</tr>
<tr>
<td>å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰</td>
<td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„</td>
<td>å¹»è¯»</td>
</tr>
<tr>
<td>ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰</td>
<td>åŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œ</td>
<td></td>
</tr>
</tbody></table>
<h3 id="äº‹åŠ¡éš”ç¦»çš„å®ç°"><a href="#äº‹åŠ¡éš”ç¦»çš„å®ç°" class="headerlink" title="äº‹åŠ¡éš”ç¦»çš„å®ç°"></a>äº‹åŠ¡éš”ç¦»çš„å®ç°</h3><p><img src="day3-tx-readview.png" alt=""></p>
<p>åœ¨ MySQL ä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-viewï¼Œè¦å¾—åˆ° read-view A çš„å€¼ï¼Œå°±è¦ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œã€‚</p>
<p>è®°å½•è¿™äº›å›æ»šæ“ä½œçš„å›æ»šæ—¥å¿—ï¼Œåªæœ‰å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„ read-view çš„æ—¶å€™æ‰ä¼šåˆ é™¤ã€‚</p>
<p>æ‰€ä»¥é•¿äº‹åŠ¡é™¤äº†ä¼šå½±å“è®¿é—®é€Ÿåº¦ä¹‹å¤–ï¼Œè¿˜ä¼šé€ æˆå¤§é‡å›æ»šæ—¥å¿—æ— æ³•åˆ é™¤ï¼Œå ç”¨ç©ºé—´ã€‚</p>
<h3 id="ä¸šåŠ¡å¼€å‘ä¸­å¯¹é•¿äº‹åŠ¡çš„æ€è€ƒ"><a href="#ä¸šåŠ¡å¼€å‘ä¸­å¯¹é•¿äº‹åŠ¡çš„æ€è€ƒ" class="headerlink" title="ä¸šåŠ¡å¼€å‘ä¸­å¯¹é•¿äº‹åŠ¡çš„æ€è€ƒ"></a>ä¸šåŠ¡å¼€å‘ä¸­å¯¹é•¿äº‹åŠ¡çš„æ€è€ƒ</h3><p>æ‰‹åŠ¨å¼€é—­äº‹åŠ¡ï¼Œå‡å°‘åœ¨å¼€å¯è¿‡ç¨‹ä¸­è¿›è¡Œçš„æ— å¿…è¦æ“ä½œï¼Œè‡ªç„¶æ˜¯å¯ä»¥ç¼©çŸ­äº‹åŠ¡æ—¶é—´ã€‚ä½†å¯¹äºä¸šåŠ¡å¼€å‘æ¥è¯´ï¼Œè¿™æ— ç–‘å¢åŠ äº†å¼€å‘æˆæœ¬ã€‚æœ¬æ¥ä¸šåŠ¡é¡¹ç›®ä¸­ä½¿ç”¨å„ç§ORMæ¡†æ¶å°±æ˜¯ä¸ºäº†ä»¥é¢å‘å¯¹è±¡çš„æ€ç»´æ–¹å¼æ¥æ“ä½œå…³ç³»å‹æ•°æ®åº“ï¼Œå‡å°‘åœ¨ä¸šåŠ¡ä»£ç ä¸­å‡ºç°è¿‡å¤šçš„æ•°æ®åº“ç»†èŠ‚ã€‚è€Œæ‰‹åŠ¨å¼€é—­äº‹åŠ¡ï¼Œæ—¢å¯¹ä¸šåŠ¡ä»£ç é€ æˆä¾µå…¥ï¼Œä¹Ÿæ— æ³•ä¿è¯é€»è¾‘å‡ºé”™æ—¶äº‹åŠ¡èƒ½æ­£å¸¸å…³é—­ã€‚</p>
<p>æ‰€ä»¥äº‹åŠ¡çš„å¼€é—­è¿˜æ˜¯åº”è¯¥ç”±æ¡†æ¶æ§åˆ¶ï¼Œé™¤äº†Springé‚£æ ·é€šè¿‡åœ¨æ–¹æ³•ä¸ŠåŠ æ³¨è§£çš„å½¢å¼ï¼Œä¹‹å‰åœ¨ç™¾åº¦çš„å·¥ä½œä¸­è¿˜è§è¿‡ä¸€ç§åŠæ³•ï¼Œå¤§æ¦‚ç±»ä¼¼äºä¸‹é¢è¿™æ ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> T &lt;T&gt; executeTx(Callable&lt;T&gt; callable) &#123;</span><br><span class="line">    T r;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        r = callable.call();</span><br><span class="line">        <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="comment">// å›æ»šäº‹åŠ¡</span></span><br><span class="line">        <span class="keyword">throw</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨éœ€è¦äº‹åŠ¡çš„æ—¶å€™é€šè¿‡æ‰§è¡Œ<code>executeTx</code>å¼€å¯ï¼Œè€Œä¸æ˜¯å•çº¯çš„å°†serviceå±‚çš„æ–¹æ³•ä½œä¸ºäº‹åŠ¡æ‰§è¡Œçš„å•ä½ã€‚æ¯”å¦‚å¯ä»¥åœ¨äº‹åŠ¡æ‰§è¡Œå‰ï¼Œå°†éœ€è¦ç”¨çš„çš„æ•°æ®éƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†è®¡ç®—ï¼Œæ•°æ®æœ€ç»ˆè¦å…¥åº“æ—¶å†è°ƒç”¨<code>executeTx</code>ä½¿ç”¨äº‹åŠ¡ã€‚</p>
]]></content>
      <categories>
        <category>MySQLå­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Mavené¡¹ç›®ä»¥Shadedå½¢å¼å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–åº“</title>
    <url>/blog/2020/01/13/Shaded-Thirdparty-Dependencies/</url>
    <content><![CDATA[<p>æœ€è¿‘æœ‰ç”¨æˆ·åé¦ˆï¼Œä»–çš„é¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨äº†HBaseå’Œä¸€ä¸ªRPCæ¡†æ¶ï¼ŒHBaseä¾èµ–2.5.0çš„protobufï¼ŒRPCæ¡†æ¶ä¾èµ–3.7çš„protobufï¼Œå¯¼è‡´ä»–çš„é¡¹ç›®ç¼–è¯‘éƒ½å¤±è´¥ã€‚0.98ç‰ˆæœ¬çš„HBaseè¿˜æ˜¯ä½¿ç”¨çš„åŸç”Ÿçš„protobuf-javaä¾èµ–ï¼Œ2.0ç‰ˆæœ¬æ‰ä½¿ç”¨äº†shadedå½¢å¼çš„protobufï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šè‡ªå·±æä¾›ä»¥shadedå½¢å¼å¼•å…¥protobufçš„HBase Clientã€‚</p>
<p>ç›¸ä¿¡è¿™ä¸ªé—®é¢˜ä¸åªæ˜¯å‡ºç°åœ¨HBaseä¸­ï¼Œæˆ–è€…å‡ºç°åœ¨ä¸protobufç›¸å…³çš„é¡¹ç›®ä¸­ï¼Œå…¶å®å½“æˆ‘ä»¬é¡¹ç›®é—´æ¥ä¾èµ–äº†åƒprotobufã€nettyç­‰å¤§ç‰ˆæœ¬ä¹‹é—´äº’ä¸å…¼å®¹çš„æ¡†æ¶ï¼Œç”šè‡³guavaè¿™ç§æŸäº›æ¥å£ä¸å…¼å®¹çš„æ¡†æ¶ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°ç±»ä¼¼çš„é—®é¢˜ã€‚è¿™é‡Œä¹Ÿæ˜¯æä¾›ä¸€ä¸ªå¯ä»¥å‚è€ƒçš„è§£å†³æ–¹æ³•ã€‚</p>
<p>æ–¹æ³•ä¸Šï¼Œå‚è€ƒäº†HBase 2.0ä¹‹åå¯¹ç¬¬ä¸‰æ–¹ä¾èµ–çš„å¤„ç†ï¼Œç®€å•æ¥è¯´å°±æ˜¯å°†å¸¸ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–çš„ä»£ç è´Ÿè´£ä¸€ä»½ï¼Œä¿®æ”¹æ‰€æœ‰ç±»çš„packageï¼Œå‘å¸ƒä¸€ä¸ªè‡ªå·±çš„artifactåˆ°ä»“åº“ä¸­ã€‚è¿™æ ·è‚¯å®šå°±ä¸ä¼šå†ä¾èµ–å†²çªäº†ã€‚</p>
<p>è€Œprotobufçš„ä¾èµ–å¤„ç†èµ·æ¥åˆ™æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œé™¤äº†ä¿®æ”¹åŸç”Ÿprotobufç±»çš„packageä¹‹å¤–ï¼Œè¿˜éœ€è¦å¤„ç†protoç”Ÿæˆçš„Javaæ–‡ä»¶ã€‚æ‰€ä»¥æœ¬æ–‡å°±ä»¥protobufä¸ºä¾‹ï¼Œæä¾›ç¬¬ä¸‰æ–¹ä¾èµ–å†²çªçš„è§£å†³æ–¹æ¡ˆã€‚å› ä¸ºéƒ½æ˜¯ä½¿ç”¨Mavenæ’ä»¶å®ç°ï¼Œæ‰€ä»¥ä¹Ÿåªå¯¹Mavené¡¹ç›®æœ‰ç”¨ï¼Œç›¸ä¿¡å…¶ä»–é¡¹ç›®ä¹Ÿæœ‰ç±»ä¼¼çš„è§£å†³åŠæ³•ã€‚</p>
<p>æœ¬æ–‡ç›¸å…³ä»£ç éƒ½å·²æ”¾åœ¨<a href="https://github.com/ddupg/demos/tree/master/shaded" target="_blank" rel="noopener">Github</a></p>
<a id="more"></a>

<h2 id="ç”Ÿæˆshadedä¾èµ–åŒ…"><a href="#ç”Ÿæˆshadedä¾èµ–åŒ…" class="headerlink" title="ç”Ÿæˆshadedä¾èµ–åŒ…"></a>ç”Ÿæˆshadedä¾èµ–åŒ…</h2><p>å¯ä»¥ç›´æ¥å‚è€ƒ<a href="https://github.com/ddupg/demos/blob/master/shaded/pom.xml" target="_blank" rel="noopener">pom.xmlçš„ä»£ç </a>ï¼Œå…¶ä¸­ä¸»è¦ä½¿ç”¨åˆ°çš„æ’ä»¶æ˜¯ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>maven-dependency-plugin å°†protobufä¾èµ–åŒ…ä¸‹è½½ä¸‹æ¥å¹¶è§£åŒ…æ”¾åœ¨src/main/javaç›®å½•ä¸‹ï¼Œå˜æˆè‡ªå·±é¡¹ç›®çš„æºç </li>
<li>maven-shade-plugin åœ¨æ‰“åŒ…é˜¶æ®µï¼Œä¿®æ”¹protobufç±»çš„packageåã€‚ä¾‹å¦‚HBaseé¡¹ç›®æ˜¯å°†<code>com.google.protobuf</code>æ”¹ä¸º<code>org.apache.hbase.thirdparty.com.google.protobuf</code>ï¼Œæˆ‘çš„ä»£ç ä¸­æ˜¯å°†<code>com.google.protobuf</code>æ”¹ä¸º<code>ddupg.demo.thirdparty.com.google.protobuf</code></li>
<li>maven-clean-plugin åœ¨æ“ä½œä¹‹å‰ï¼Œæ¸…ç†ä¸‹ä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶</li>
</ul>
<p>ä¿®æ”¹å¥½pomæ–‡ä»¶ä¹‹åï¼Œç›´æ¥mvn clean deployå‘å¸ƒåˆ°ä»“åº“å°±å¥½äº†ï¼Œä¸­å¤®ä»“åº“å’Œç§æœ‰ä»“åº“éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å¯ä»¥è§£å‹targetç›®å½•ä¸‹æ‰“å¥½çš„åŒ…ï¼Œå°±å¯ä»¥çœ‹åˆ°classæ–‡ä»¶çš„packageè·¯å¾„å·²ç»å˜åŒ–äº†ã€‚å› ä¸ºæ˜¯åœ¨packageé˜¶æ®µæ‰ä¿®æ”¹çš„packageåï¼Œæ‰€ä»¥ç›´æ¥çœ‹target/generated-sourcesä¸‹çš„classæ–‡ä»¶å…¶å®æ˜¯ä¸å˜çš„ã€‚</p>
<p>æ™®é€šçš„ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹ç›®ä½¿ç”¨è¿™ä¸€æ­¥å…¶å®å°±å¯ä»¥è§£å†³äº†ã€‚</p>
<h2 id="ç”Ÿæˆprotoæ–‡ä»¶"><a href="#ç”Ÿæˆprotoæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆprotoæ–‡ä»¶"></a>ç”Ÿæˆprotoæ–‡ä»¶</h2><p>è§£å†³æ‰äº†protobufçš„æºæ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¤„ç†protoç”Ÿæˆçš„æ–‡ä»¶äº†ã€‚</p>
<p>å› ä¸ºéœ€è¦ä¾èµ–ä¸Šä¸€æ­¥ç”Ÿæˆçš„shadedåŒ…ï¼Œè€Œæˆ‘åˆæ²¡æœ‰å°†å®ƒdeployåˆ°ä¸­å¤®ä»“åº“ï¼Œä¹Ÿæ²¡æœ‰è‡ªå·±çš„ç§äººä»“åº“ï¼Œæ‰€ä»¥ä¾¿ä½¿ç”¨äº†<a href="https://github.com/apache/hbase-thirdparty" target="_blank" rel="noopener">HBaseé¡¹ç›®çš„ç¬¬ä¸‰æ–¹ä¾èµ–</a>ï¼Œé“ç†éƒ½ä¸€æ ·ï¼Œæ›¿æ¢ä¸€ä¸‹dependencyå°±å¥½äº†ã€‚</p>
<p>å¯ä»¥ç›´æ¥å‚è€ƒ<a href="https://github.com/ddupg/demos/blob/master/shaded/shaded-protocol/pom.xml" target="_blank" rel="noopener">pom.xmlçš„ä»£ç </a>.</p>
<p>è¿™ä¸€æ­¥ä¸»è¦ä½¿ç”¨çš„æ’ä»¶ï¼š</p>
<ul>
<li>protobuf-maven-plugin ç”Ÿæˆprotoæ–‡ä»¶ï¼Œè¿™ä¸€æ­¥ç”Ÿæˆçš„æ–‡ä»¶ä¾æ—§ä½¿ç”¨çš„æ˜¯åŸç”Ÿprotobufã€‚</li>
<li>com.google.code.maven-replacer-plugin:replacer æ›¿æ¢æºä»£ç ï¼Œå°†protobufåŸç”Ÿçš„packageè·¯å¾„<code>com.google.protobuf</code>æ”¹æˆç¬¬ä¸€æ­¥ä¸­ä¿®æ”¹åçš„packageåã€‚å› ä¸ºæˆ‘åœ¨è¿™é‡Œä½¿ç”¨çš„HBaseçš„ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹ç›®ï¼Œæ‰€ä»¥å°±æ˜¯å°†<code>com.google.protobuf</code>æ”¹ä¸º<code>org.apache.hbase.thirdparty.com.google.protobuf</code></li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.xolstice.org/protobuf-maven-plugin/" target="_blank" rel="noopener">Maven Protocol Buffers Plugin</a></li>
<li><a href="https://maven.apache.org/plugins/maven-shade-plugin/" target="_blank" rel="noopener">Apache Maven Shade Plugin</a></li>
<li><a href="https://code.google.com/archive/p/maven-replacer-plugin/" target="_blank" rel="noopener">maven-replacer-plugin</a></li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŒTEDã€How you can help transform the internet into a place of trust</title>
    <url>/blog/2020/01/03/ted-how-you-can-help-transform-the-internet-into-a-place-of-trust/</url>
    <content><![CDATA[<p><a href="https://www.ted.com/talks/claire_wardle_how_you_can_help_transform_the_internet_into_a_place_of_trust/" target="_blank" rel="noopener">TEDè§†é¢‘é“¾æ¥</a></p>
<a id="more"></a>

<p>No matter who you are or where you live, Iâ€™m guessing that you have at least one relative that likes to forward those emails. You know the ones Iâ€™m talking about â€“ the ones with dubious claims or conspiracy videos. And youâ€™ve probably already muted them on Facebook for sharing social posts like this one. </p>
<blockquote>
<p><a href="https://fanyi.baidu.com/#en/zh/relative" target="_blank" rel="noopener">relative</a>  [ËˆrelÉ™tÉªv]<br>adj. ç›¸æ¯”è¾ƒè€Œè¨€çš„;æ¯”è¾ƒçš„;ç›¸å¯¹çš„;ç›¸å…³è”çš„;ç›¸æ¯”ä¹‹ä¸‹å­˜åœ¨(æˆ–æœ‰)çš„<br>n. äº²æˆš;äº²å±;åŒç±»äº‹ç‰©</p>
</blockquote>
<blockquote>
<p><a href="https://fanyi.baidu.com/#en/zh/dubious" target="_blank" rel="noopener">dubious</a> [ËˆduËbiÉ™s]<br>adj. æ€€ç–‘;æ— æŠŠæ¡;æ‹¿ä¸å‡†;å¯ç–‘çš„;ä¸å¯ä¿¡çš„;é ä¸ä½çš„;ä¸è¯šå®çš„;ä¸ç¡®å®šçš„;ä¸ä¸€å®šå¥½çš„</p>
</blockquote>
<blockquote>
<p><a href="https://fanyi.baidu.com/#en/zh/conspiracy" target="_blank" rel="noopener">conspiracy</a> [kÉ™nËˆspÉªrÉ™si]<br>n. å¯†è°‹ç­–åˆ’;é˜´è°‹</p>
</blockquote>
<blockquote>
<p><a href="https://fanyi.baidu.com/#en/zh/mute" target="_blank" rel="noopener">mute</a> [mjuËt]<br>adj. æ²‰é»˜çš„;ä¸å‡ºå£°çš„;æ— å£°çš„;å“‘çš„<br>n. å¼±éŸ³å™¨;å“‘å·´<br>v. æ¶ˆéŸ³;å‡éŸ³;å‡å¼±(å°¤æŒ‡ä¹å™¨)çš„å£°éŸ³;å‡å¼±;ç¼“è§£<br>è¿™é‡Œæ˜¯<strong>å±è”½</strong>çš„æ„æ€</p>
</blockquote>
<p>Itâ€™s an image of a banana with a strange red cross running through the center. And the text around it is warning people not to eat fruits that look like this, suggesting theyâ€™ve been injected with blood contaminated with the HIV virus. And the social share message above it simply says, â€œPlease forward to save lives.â€ Now, fact-checkers have been debunking this one for years, but itâ€™s one of those rumors that just wonâ€™t die. A zombie rumor. And, of course, itâ€™s entirely false. </p>
<p>It might be tempting to laugh at an example like this, to say, â€œWell, who would believe this, anyway?â€ But the reason itâ€™s a zombie rumor is because it taps into peopleâ€™s deepest fears about their own safety and that of the people they love. And if you spend as enough time as I have looking at misinformation, you know that this is just one example of many that taps into peopleâ€™s deepest fears and vulnerabilities. </p>
<p>Every day, across the world, we see scores of new memes on Instagram encouraging parents not to vaccinate their children. We see new videos on YouTube explaining that climate change is a hoax. And across all platforms, we see endless posts designed to demonize others on the basis of their race, religion or sexuality. </p>
<p>Welcome to one of the central challenges of our time. How can we maintain an internet with freedom of expression at the core, while also ensuring that the content thatâ€™s being disseminated doesnâ€™t cause irreparable harms to our democracies, our communities and to our physical and mental well-being? Because we live in the information age, yet the central currency upon which we all depend â€“ information â€“ is no longer deemed entirely trustworthy and, at times, can appear downright dangerous. This is thanks in part to the runaway growth of social sharing platforms that allow us to scroll through, where lies and facts sit side by side, but with none of the traditional signals of trustworthiness. </p>
<p>And goodness â€“ our language around this is horribly muddled. People are still obsessed with the phrase â€œfake news,â€ despite the fact that itâ€™s extraordinarily unhelpful and used to describe a number of things that are actually very different: lies, rumors, hoaxes, conspiracies, propaganda. And I really wish we could stop using a phrase thatâ€™s been co-opted by politicians right around the world, from the left and the right, used as a weapon to attack a free and independent press. </p>
<p>(Applause) </p>
<p>Because we need our professional news media now more than ever. And besides, most of this content doesnâ€™t even masquerade as news. Itâ€™s memes, videos, social posts. And most of it is not fake; itâ€™s misleading. We tend to fixate on whatâ€™s true or false. But the biggest concern is actually the weaponization of context. Because the most effective disinformation has always been that which has a kernel of truth to it. </p>
<p>Letâ€™s take this example from London, from March 2017, a tweet that circulated widely in the aftermath of a terrorist incident on Westminster Bridge. This is a genuine image, not fake. The woman who appears in the photograph was interviewed afterwards, and she explained that she was utterly traumatized. She was on the phone to a loved one, and she wasnâ€™t looking at the victim out of respect. But it still was circulated widely with this Islamophobic framing, with multiple hashtags, including: #BanIslam. Now, if you worked at Twitter, what would you do? Would you take that down, or would you leave it up? My gut reaction, my emotional reaction, is to take this down. I hate the framing of this image. But freedom of expression is a human right, and if we start taking down speech that makes us feel uncomfortable, weâ€™re in trouble. </p>
<p>And this might look like a clear-cut case, but, actually, most speech isnâ€™t. These lines are incredibly difficult to draw. Whatâ€™s a well-meaning decision by one person is outright censorship to the next. What we now know is that this account, Texas Lone Star, was part of a wider Russian disinformation campaign, one that has since been taken down. Would that change your view? It would mine, because now itâ€™s a case of a coordinated campaign to sow discord. And for those of you whoâ€™d like to think that artificial intelligence will solve all of our problems, I think we can agree that weâ€™re a long way away from AI thatâ€™s able to make sense of posts like this. </p>
<p>So Iâ€™d like to explain three interlocking issues that make this so complex and then think about some ways we can consider these challenges. First, we just donâ€™t have a rational relationship to information, we have an emotional one. Itâ€™s just not true that more facts will make everything OK, because the algorithms that determine what content we see, well, theyâ€™re designed to reward our emotional responses. And when weâ€™re fearful, oversimplified narratives, conspiratorial explanations and language that demonizes others is far more effective. And besides, many of these companies, their business model is attached to attention, which means these algorithms will always be skewed towards emotion. </p>
<p>Second, most of the speech Iâ€™m talking about here is legal. It would be a different matter if I was talking about child sexual abuse imagery or content that incites violence. It can be perfectly legal to post an outright lie. But people keep talking about taking down â€œproblematicâ€ or â€œharmfulâ€ content, but with no clear definition of what they mean by that, including Mark Zuckerberg, who recently called for global regulation to moderate speech. And my concern is that weâ€™re seeing governments right around the world rolling out hasty policy decisions that might actually trigger much more serious consequences when it comes to our speech. And even if we could decide which speech to take up or take down, weâ€™ve never had so much speech. Every second, millions of pieces of content are uploaded by people right around the world in different languages, drawing on thousands of different cultural contexts. Weâ€™ve simply never had effective mechanisms to moderate speech at this scale, whether powered by humans or by technology. </p>
<p>And third, these companies â€“ Google, Twitter, Facebook, WhatsApp â€“ theyâ€™re part of a wider information ecosystem. We like to lay all the blame at their feet, but the truth is, the mass media and elected officials can also play an equal role in amplifying rumors and conspiracies when they want to. As can we, when we mindlessly forward divisive or misleading content without trying. Weâ€™re adding to the pollution. </p>
<p>I know weâ€™re all looking for an easy fix. But there just isnâ€™t one. Any solution will have to be rolled out at a massive scale, internet scale, and yes, the platforms, theyâ€™re used to operating at that level. But can and should we allow them to fix these problems? Theyâ€™re certainly trying. But most of us would agree that, actually, we donâ€™t want global corporations to be the guardians of truth and fairness online. And I also think the platforms would agree with that. And at the moment, theyâ€™re marking their own homework. They like to tell us that the interventions theyâ€™re rolling out are working, but because they write their own transparency reports, thereâ€™s no way for us to independently verify whatâ€™s actually happening. </p>
<p>(Applause) </p>
<p>And letâ€™s also be clear that most of the changes we see only happen after journalists undertake an investigation and find evidence of bias or content that breaks their community guidelines. So yes, these companies have to play a really important role in this process, but they canâ€™t control it. </p>
<p>So what about governments? Many people believe that global regulation is our last hope in terms of cleaning up our information ecosystem. But what I see are lawmakers who are struggling to keep up to date with the rapid changes in technology. And worse, theyâ€™re working in the dark, because they donâ€™t have access to data to understand whatâ€™s happening on these platforms. And anyway, which governments would we trust to do this? We need a global response, not a national one. </p>
<p>So the missing link is us. Itâ€™s those people who use these technologies every day. Can we design a new infrastructure to support quality information? Well, I believe we can, and Iâ€™ve got a few ideas about what we might be able to actually do. So firstly, if weâ€™re serious about bringing the public into this, can we take some inspiration from Wikipedia? Theyâ€™ve shown us whatâ€™s possible. Yes, itâ€™s not perfect, but theyâ€™ve demonstrated that with the right structures, with a global outlook and lots and lots of transparency, you can build something that will earn the trust of most people. Because we have to find a way to tap into the collective wisdom and experience of all users. This is particularly the case for women, people of color and underrepresented groups. Because guess what? They are experts when it comes to hate and disinformation, because they have been the targets of these campaigns for so long. And over the years, theyâ€™ve been raising flags, and they havenâ€™t been listened to. This has got to change. So could we build a Wikipedia for trust? Could we find a way that users can actually provide insights? They could offer insights around difficult content-moderation decisions. They could provide feedback when platforms decide they want to roll out new changes. </p>
<p>Second, peopleâ€™s experiences with the information is personalized. My Facebook news feed is very different to yours. Your YouTube recommendations are very different to mine. That makes it impossible for us to actually examine what information people are seeing. So could we imagine developing some kind of centralized open repository for anonymized data, with privacy and ethical concerns built in? Because imagine what we would learn if we built out a global network of concerned citizens who wanted to donate their social data to science. Because we actually know very little about the long-term consequences of hate and disinformation on peopleâ€™s attitudes and behaviors. And what we do know, most of that has been carried out in the US, despite the fact that this is a global problem. We need to work on that, too. </p>
<p>And third, can we find a way to connect the dots? No one sector, let alone nonprofit, start-up or government, is going to solve this. But there are very smart people right around the world working on these challenges, from newsrooms, civil society, academia, activist groups. And you can see some of them here. Some are building out indicators of content credibility. Others are fact-checking, so that false claims, videos and images can be down-ranked by the platforms. </p>
<p>A nonprofit I helped to found, First Draft, is working with normally competitive newsrooms around the world to help them build out investigative, collaborative programs. And Danny Hillis, a software architect, is designing a new system called The Underlay, which will be a record of all public statements of fact connected to their sources, so that people and algorithms can better judge what is credible. And educators around the world are testing different techniques for finding ways to make people critical of the content they consume. All of these efforts are wonderful, but theyâ€™re working in silos, and many of them are woefully underfunded. </p>
<p>There are also hundreds of very smart people working inside these companies, but again, these efforts can feel disjointed, because theyâ€™re actually developing different solutions to the same problems. </p>
<p>How can we find a way to bring people together in one physical location for days or weeks at a time, so they can actually tackle these problems together but from their different perspectives? So can we do this? Can we build out a coordinated, ambitious response, one that matches the scale and the complexity of the problem? I really think we can. Together, letâ€™s rebuild our information commons. </p>
<p>Thank you. </p>
<p>(Applause) </p>
]]></content>
      <categories>
        <category>English</category>
      </categories>
      <tags>
        <tag>TED</tag>
        <tag>English</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆæ­¥äº†è§£HBase Region Replicas</title>
    <url>/blog/2019/12/05/Initial-Analysis-Region-Replicas/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>CAPåŸç†ä¸­ï¼ŒæŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ (Consistency)ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼Œè€ŒHBaseåˆ™è¢«è®¾è®¡æˆä¸€ä¸ªCPç³»ç»Ÿï¼Œä¿è¯äº†å¼ºä¸€è‡´æ€§çš„åŒæ—¶ï¼Œé€‰æ‹©ç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ã€‚</p>
<p>åœ¨å¯¹HBaseçš„å‹æµ‹ä¸­ï¼Œå¾ˆå®¹æ˜“å‘ç°è™½ç„¶HBaseçš„å¹³å‡è¯»å†™å»¶è¿Ÿå¾ˆä½ï¼Œä½†å´å­˜åœ¨å¾ˆé«˜çš„æ¯›åˆºï¼ŒP99ã€P999å»¶è¿Ÿå¾ˆé«˜ï¼Œä¸»è¦çš„ä¸€ä¸ªå½±å“å› ç´ åˆ™æ˜¯å•ç‚¹çš„GCï¼Œå¦å¤–Regionçš„MTTRï¼ˆå¹³å‡ä¿®å¤æ—¶é—´ï¼‰ä¹Ÿè¾ƒé«˜ï¼Œä¸€æ—¦æŸä¸ªRegionServerå®•æœºæˆ–æŸä¸ªRegionå‡ºç°é—®é¢˜ï¼Œç”šè‡³æ˜¯ä¸€æ¬¡Full GCï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°è¾ƒé•¿æ—¶é—´çš„ä¸å¯ç”¨ï¼Œå½±å“å¯ç”¨æ€§ã€‚</p>
<p>HBaseçš„Read Region ReplicasåŠŸèƒ½ï¼Œæä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ï¼Œåœ¨regionæ¢å¤æœŸé—´æˆ–è¯·æ±‚æ—¶é—´è¿‡é•¿æ—¶ï¼Œæ”¯æŒæœ€ç»ˆä¸€è‡´æ€§çš„è¯»æœåŠ¡ã€‚åœ¨ä¸€äº›ä¸è¦æ±‚å¼ºä¸€è‡´æ€§çš„åº”ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡æ­¤åŠŸèƒ½æ¥æé«˜å¯ç”¨æ€§é™ä½è¯»è¯·æ±‚å»¶è¿Ÿã€‚</p>
<p>ä¸ºäº†å®ç°é«˜å¯ç”¨è¯»ï¼ŒHBaseæä¾›äº†ä¸€ä¸ªfeatureï¼Œå«<code>region replication</code>ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œè¡¨çš„æ¯ä¸ªregionï¼Œéƒ½ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„RegionServerä¸Šã€‚é»˜è®¤region replicationä¸º1ï¼Œæ­¤æ—¶ä¸ä¹‹å‰çš„regionæ¨¡å‹å¹¶æ— ä¸åŒã€‚å½“region replicationè¢«è®¾ç½®ä¸º2æˆ–æ›´å¤šæ—¶ï¼ŒMasterå°†ä¼šassignæ‰€æœ‰regionçš„secondary regionï¼ŒLoad Balancerä¼šä¿è¯åŒä¸€ä¸ªregionçš„å¤šä¸ªå¤‡ä»½ä¼šè¢«åˆ†æ•£åœ¨ä¸åŒçš„RegionServerä¸Šã€‚</p>
<p>ä¸€ä¸ªregionçš„æ‰€æœ‰å‰¯æœ¬éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„replica_idã€‚replica_id=0çš„æ˜¯primary regionï¼ˆå’Œä¹‹å‰æ¨¡å‹ä¸­å”¯ä¸€çš„regionä¸€æ ·ï¼‰ï¼Œå…¶ä»–çš„å‰¯æœ¬regionè¢«éƒ½å«åšsecondary regionã€‚</p>
<p>primary regionï¼Œæ”¯æŒè¯»å†™è¯·æ±‚ï¼›secondary regionï¼Œåªæ”¯æŒè¯»è¯·æ±‚ã€‚å¦‚æ­¤è®¾è®¡ä¿è¯primary regionä¾æ—§å…·æœ‰å¼ºä¸€è‡´æ€§ï¼ŒåŒæ—¶æé«˜è¯»å¯ç”¨æ€§ã€‚ä½†ä¹Ÿå› ä¸ºå†™è¯·æ±‚åªæœ‰primary regionå¯ä»¥å¤„ç†ï¼Œæ‰€ä»¥å†™è¯·æ±‚ä¾ç„¶ä¼šå› ä¸ºprimary regionä¸å¯ç”¨è€Œè¢«é˜»å¡ï¼ŒHBaseçš„å†™å¯ç”¨æ€§ä¾ç„¶æ²¡æœ‰å¾—åˆ°æ”¹å–„ã€‚</p>
<a id="more"></a>

<h2 id="Timeline-Consistency"><a href="#Timeline-Consistency" class="headerlink" title="Timeline Consistency"></a>Timeline Consistency</h2><p>åœ¨è¯¥åŠŸèƒ½çš„å®ç°ä¸­ï¼ŒHBaseæä¾›äº†ä¸€ç§æ”¯æŒ<strong>å•æ¬¡è¯»è¯·æ±‚</strong>çš„ä¸€è‡´æ€§å®šä¹‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Consistency &#123;</span><br><span class="line">    STRONG,</span><br><span class="line">    TIMELINE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HBaseé»˜è®¤çš„å°±æ˜¯<code>Consistency.STRONG</code>å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œä¸ä¹‹å‰çš„æ¨¡å‹ä¸€æ ·ï¼Œæ‰€æœ‰è¯»å†™æ“ä½œéƒ½é€šprimary regionå®Œæˆã€‚</p>
<p>è€Œå½“clientä½¿ç”¨<code>Consistency.TIMELINE</code>çš„ä¸€è‡´æ€§å‘èµ·è¯»è¯·æ±‚æ—¶ï¼Œä¼šé¦–å…ˆå‘primary regionå‘èµ·è¯·æ±‚ï¼Œä¸€å®šæ—¶é—´å†…æ²¡æœ‰è¿”å›å“åº”ï¼Œåˆ™åŒæ—¶å¹¶å‘å‘æ‰€æœ‰çš„secondary regionå‘èµ·è¯·æ±‚ï¼Œæœ€ç»ˆé‡‡ç”¨ç‡å…ˆè¿”å›çš„è¯·æ±‚ã€‚ä¸ºäº†åŒºåˆ†æœ€ç»ˆçš„å“åº”æ˜¯å¦æ¥è‡ªsecondary regionï¼Œåœ¨<code>Result</code>ä¸­å¢åŠ äº†<code>stale</code>çš„booleanå±æ€§ï¼Œ<code>true</code>åˆ™è¡¨ç¤ºæ¥è‡ªsecondary regionã€‚</p>
<p>ä»è¯­ä¹‰ä¸Šè®²ï¼ŒHBaseçš„TIMELINEä¸€è‡´æ€§å¹¶ä¸åŒäºå¸¸è§çš„æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li>å³ä½¿å­˜åœ¨å¤šå‰¯æœ¬ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘å‰¯æœ¬ä¹‹é—´æ•°æ®å†²çªçš„é—®é¢˜ã€‚</li>
<li>secondary regionæ¥æ”¶primary regionåŒæ­¥çš„æ•°æ®ï¼ŒæŒ‰åŒæ ·é¡ºåºå¤„ç†æ•°æ®ï¼Œæ‰€ä»¥secondary regionæ€»æ˜¯primary regionåœ¨ä¹‹å‰æŸä¸ªæ—¶åˆ»çš„å¿«ç…§ã€‚ä»è¿™ä¸€ç‚¹ä¸Šçœ‹ï¼Œæ›´åƒæ˜¯RDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰çš„å¤åˆ¶ã€æˆ–æ˜¯HBaseå¤šæ•°æ®ä¸­å¿ƒå¤šé›†ç¾¤ä¹‹é—´çš„å¤åˆ¶ã€‚</li>
<li>å¦ä¸€æ–¹é¢ï¼Œclientå¯ä»¥è‡ªè¡Œå†³å®šæ˜¯å¦éœ€è¦è¯»å–æœ€æ–°æ•°æ®ï¼Œè‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ç§ä¸€è‡´æ€§æ¥æ»¡è¶³åŠŸèƒ½éœ€æ±‚ã€‚</li>
<li>clientä¾ç„¶ä¼šè¯»åˆ°ä¹±åºçš„æ•°æ®ï¼Œæ¯”å¦‚å¤šæ¬¡è¯·æ±‚å‘å¾€äº†ä¸åŒçš„regionã€‚ç›®å‰å¹¶æ²¡æœ‰ç±»ä¼¼äºäº‹åŠ¡çš„ä¸œè¥¿æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li>
</ul>
<p><img src="timeline_consistency.png" alt="Timeline Consistency"></p>
<p>æ ¹æ®ä¸Šå›¾æˆ‘ä»¬æ¥æ›´å¥½çš„ç†è§£TIMELINEçš„è¯­ä¹‰ã€‚é¦–å…ˆclient1æŒ‰é¡ºåºå†™äº†x=1,x=2,x=3ï¼Œprimary regionä¹ŸæŒ‰å†™å…¥é¡ºåºå¤„ç†ï¼Œå¹¶å°†WALåŒæ­¥ç»™å…¶ä»–secondary regionï¼ˆä¸€ç§æ•°æ®åŒæ­¥æ–¹å¼ï¼Œåé¢ä¼šå†è®²ï¼‰ã€‚åœ¨å›¾ä¸­æ³¨æ„åˆ°ï¼Œreplica_1åªæ¥æ”¶åˆ°ä¸¤æ¬¡æ›´æ–°ï¼Œæ‰€ä»¥æœ€ç»ˆæ•°æ®æ˜¯x=2ï¼Œreplica_2åªæ¥æ”¶åˆ°1æ¬¡æ›´æ–°ï¼Œæ•°æ®æ˜¯x=1ã€‚</p>
<p>å¦‚æœclient1ä½¿ç”¨STRONGä¸€è‡´æ€§æ¥è¯»æ•°æ®ï¼Œéƒ½åªä¼šå’Œprimary regionäº¤äº’ï¼Œæ•°æ®éƒ½æ˜¯æœ€æ–°å€¼x=3ã€‚å¯å¦‚æœä½¿ç”¨TIMELINEä¸€è‡´æ€§è¯»å–æ•°æ®ï¼Œæœ‰å¯èƒ½å’Œæ‰€æœ‰å‰¯æœ¬åšäº¤äº’ï¼Œæœ€ç»ˆè·å¾—çš„æ•°æ®1ã€2ã€3éƒ½æœ‰å¯èƒ½ã€‚å¦‚æœclientè¯·æ±‚å¤šæ¬¡ï¼Œç”šè‡³å¯èƒ½å‡ºç°æ•°æ®å›é€€ï¼Œå³ç¬¬1æ¬¡è¯·æ±‚è·å¾—x=2ï¼Œç¬¬2æ¬¡è¯·æ±‚åˆ™è·å¾—äº†x=1ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><p><img src="meta.png" alt="ä¸€ä¸ªregion replicationä¸º2çš„è¡¨åœ¨metaè¡¨ä¸­çš„åˆ—" title="ä¸€ä¸ªregion replicationä¸º2çš„è¡¨åœ¨metaè¡¨ä¸­çš„åˆ—"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œæ˜¯ä¸€ä¸ªregion replicationä¸º2çš„è¡¨åœ¨metaè¡¨ä¸­infoåˆ—æ—ä¸‹çš„åˆ—ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€äº›åä¸ºinfo:xxx_0001çš„åˆ—ï¼Œè¿™äº›åˆ—å­˜å‚¨çš„æ•°æ®å°±æ˜¯replica_id=1çš„secondary regionçš„æ•°æ®ã€‚åŒç†ï¼Œå½“regionçš„å¤‡ä»½æ•°é‡æ›´å¤šæ—¶ï¼Œmetaè¡¨ä¸­åä¸ºinfo:xxx_0002ã€info:xxx_0003çš„åˆ—å­˜å‚¨çš„åˆ™ä¸ºreplica_idä¸º2ã€3çš„secondary regionçš„æ•°æ®ã€‚</p>
<p>æ˜ç™½äº†metaè¡¨ä¸­æ˜¯å¦‚ä½•å­˜å‚¨secondary regionæ•°æ®ï¼Œclientè¦è·å–secondary regionæ‰€åœ¨çš„RegionServerè‡ªç„¶ä¹Ÿç®€å•ï¼Œå¤šè§£æå‡ ä¸ªserver_xxxxçš„åˆ—ä¾¿å¯ä»¥äº†ã€‚</p>
<p><img src="client-read-replicas.png" alt="clientè®¿é—®secondary region" title="clientè®¿é—®secondary region"></p>
<p>ä¸Šå›¾å±•ç¤ºçš„æ˜¯clientè®¿é—®secondary regionçš„ç¤ºæ„å›¾ã€‚HBaseçš„è¯»è¯·æ±‚æœ‰ä¸¤ç§ï¼ŒGetå’ŒScanã€‚å¯¹äºGetè¿™ç§æ— çŠ¶æ€çš„è¯·æ±‚ï¼Œæ¯æ¬¡RPCå¯¹serverç«¯æ¥è¯´éƒ½æ˜¯ä¸€æ¬¡ç‹¬ç«‹çš„è¯·æ±‚ã€‚clientç«¯çš„ç”¨æˆ·å¯ä»¥å¤šæ¬¡è¶…æ—¶é‡è¯•ï¼Œç›´åˆ°è·å–åˆ°æ•°æ®ï¼›ä¹Ÿå¯ä»¥å¹¶å‘è¯·æ±‚å¤šä¸ªreplicaï¼Œé€‰æ‹©ç‡å…ˆè¿”å›çš„æ•°æ®ï¼›è¿˜å¯ä»¥ä½¿ç”¨TIMELINE Readï¼Œè¯·æ±‚primary regionè¶…æ—¶ä¹‹åå†è¯·æ±‚å…¶ä»–secondary regionã€‚ä½†å¯¹äºScanè¿™ç§æœ‰çŠ¶æ€çš„è¯·æ±‚ï¼Œä¸€æ¬¡scanå¯èƒ½ä¸åŒä¸€ä¸ªregionäº¤äº’å¤šæ¬¡ï¼Œä¹Ÿå¯èƒ½è·¨å¤šä¸ªregionå¤šä¸ªRegionServerè¯·æ±‚æ•°æ®ï¼Œserverç«¯ä¼šè®°å½•æ¯ä¸ªscançš„çŠ¶æ€æ•°æ®ï¼Œé‚£ä¹ˆä¸€æ¬¡scanäº§ç”Ÿçš„å¤šæ¬¡RPCä¾¿ä¸èƒ½éšæ„åœ°å‘ç»™æ‰€æœ‰çš„replicaã€‚</p>
<p><img src="client_scan_replicas.png" alt="client scanè¿‡ç¨‹" title="client scanè¿‡ç¨‹"></p>
<p>ä¸Šå›¾å±•ç¤ºçš„æ˜¯clientæ‰§è¡Œä¸€ä¸ªè·¨regionçš„scanè¿‡ç¨‹ï¼Œå‡è®¾å½“å‰è¡¨æœ‰2ä¸ªé€»è¾‘regionï¼ˆRegion_Aå’ŒRegion_Bï¼‰ï¼Œregionçš„èµ·å§‹åŒºé—´åˆ†åˆ«ä¸º[a, d)ã€[d, f)ï¼Œä¸”è¯¥è¡¨çš„region replicationä¸º2ï¼Œå³æ¯ä¸ªé€»è¾‘regionéƒ½æœ‰ä¸€ä¸»ä¸€å¤‡ï¼Œ4ä¸ªregionåˆ†å¸ƒåœ¨4ä¸ªRegionServerä¸Šã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡scanæ“ä½œï¼Œè®¾ç½®cacheingä¸º2ï¼ˆæ¯æ¬¡RPCæœ€å¤šè·å–2ä¸ªResultï¼‰ï¼Œåˆ™scanè‡³å°‘è¿›è¡Œ4æ¬¡RPCï¼Œå›¾ä¸­è¿çº¿åˆ™è¡¨ç¤ºæ¯æ¬¡RPCï¼Œè¿çº¿ä¸Šçš„æ•°å­—è¡¨ç¤ºRPCçš„é¡ºåºç¼–å·ï¼Œè™šçº¿è¡¨ç¤ºRPCè¶…æ—¶æˆ–è¿”å›å¤ªæ…¢ç»“æœæ²¡æœ‰è¢«é‡‡ç”¨ã€‚å¯ä»¥çœ‹åˆ°å½“clientè¦è¿›è¡Œç¬¬1æ¬¡RPCæ—¶ï¼Œå°†è¯·æ±‚åŒæ—¶å‘ç»™äº†Region_Açš„ä¸»å¤‡2ä¸ªregionï¼Œå› ä¸ºæ­¤æ—¶serverç«¯æ˜¯æ²¡æœ‰ä»»ä½•å…³äºæ­¤æ¬¡scançš„çŠ¶æ€æ•°æ®ï¼Œclientå¯ä»¥é€‰æ‹©ç‡å…ˆè¿”å›å“åº”çš„regionè¿›è¡Œåç»­çš„RPCäº¤äº’ã€‚å½“ç¬¬2æ¬¡RPCæ—¶ä¾¿ä¸å¯ä»¥éšæ„é€‰æ‹©regionäº†ï¼Œå› ä¸ºRegion_A_primaryå­˜å‚¨äº†æ­¤æ¬¡scançš„çŠ¶æ€æ•°æ®ï¼Œè€ŒRegion_A_replica_1æ²¡æœ‰ï¼Œå¦‚æœè¯·æ±‚Region_A_replica_1åˆ™åªä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å½“ç¬¬2æ¬¡RPCç»“æŸï¼Œå·²ç»è·å–äº†Region_Aä¸­çš„å…¨éƒ¨æ•°æ®ï¼Œä¾¿å¯ä»¥æ¸…ç†æ‰Region_A_primaryä¸­å­˜å‚¨çš„çŠ¶æ€æ•°æ®äº†ã€‚å½“ç¬¬3æ¬¡RPCæ—¶ï¼Œå’Œç¬¬1æ¬¡æ—¶æƒ…å†µæœ‰äº›ç±»ä¼¼ï¼Œserverç«¯æš‚æ—¶æ²¡æœ‰å­˜å‚¨scançš„çŠ¶æ€æ•°æ®äº†ï¼Œclientä¾¿å¯ä»¥åƒç¬¬1æ¬¡RPCä¸€æ ·ï¼Œå°†è¯·æ±‚åŒæ—¶å‘ç»™äº†Region_Açš„ä¸»å¤‡2ä¸ªregionã€‚ç¬¬4æ¬¡RPCåˆ™åƒç¬¬2æ¬¡ä¸€æ ·ã€‚æ€»ç»“ä¸€ä¸‹ï¼šå½“scanè¿›è¡ŒTIMELINE Readæ—¶ï¼Œåªæœ‰å¯¹æ¯ä¸ªé€»è¾‘regionçš„ç¬¬1æ¬¡rpcå¯ä»¥ä»»æ„é€‰æ‹©regionè¯·æ±‚ã€‚</p>
<p>ç›®å‰ï¼ŒRead Region ReplicasåŠŸèƒ½å¹¶æ²¡æœ‰æ”¯æŒæ‰¹é‡è¯·æ±‚ï¼Œå³æ‰¹é‡Getã€Scanéƒ½æ˜¯ç›´æ¥è¯·æ±‚primary regionã€‚</p>
<h3 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h3><p>secondary regionè¦æ”¯æŒè¯»è¯·æ±‚ï¼Œåˆ™å¿…ç„¶è¦æœ‰æ•°æ®ï¼Œè€Œsecondary regionåˆä¸æ”¯æŒå†™è¯·æ±‚ï¼Œé‚£ä¹ˆæ•°æ®æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ</p>
<p><img src="rs-structure.png" alt="RegionServer å†…éƒ¨ç»“æ„" title="RegionServer å†…éƒ¨ç»“æ„"></p>
<p>ä»HBaseçš„æ•°æ®æ¨¡å‹ä¸Šçœ‹ï¼Œæ•°æ®ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šMemStoreå’ŒHFileã€‚HFileå­˜å‚¨äºHDFSä¸Šï¼Œsecondary regionåªè¦åŠæ—¶è·çŸ¥HFileçš„å˜åŒ–ä¾¿å¯ä»¥è·å–ã€‚ä½†MemStoreå­˜åœ¨äºå†…å­˜ï¼Œå´åªæœ‰primary regionæŒæœ‰ã€‚ä»¥ä¸‹ä¾¿ä»‹ç»ä¸¤ç§secondary regionåŒæ­¥æ•°æ®çš„æ–¹å¼ã€‚</p>
<h4 id="StoreFile-Refresher"><a href="#StoreFile-Refresher" class="headerlink" title="StoreFile Refresher"></a>StoreFile Refresher</h4><p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯StoreFile Refresherï¼Œåœ¨HBase-1.0+ç‰ˆæœ¬å¼•å…¥ã€‚åœ¨RegionServerä¸Šæœ‰ä¸€ä¸ªStorefileRefresherChoreä»»åŠ¡ï¼Œä¼šå®šæœŸåœ°åœ¨HDFSä¸Šæ£€æŸ¥primary regionçš„HFileæœ‰æ²¡æœ‰å˜åŒ–ï¼Œä»¥æ­¤æ¥åŠæ—¶çš„å‘ç°primary regioné€šè¿‡flushã€compactã€bulk loadç­‰æ“ä½œäº§ç”Ÿçš„æ–°HFileã€‚</p>
<p>è¯¥æ–¹æ¡ˆå®ç°ä¸Šè¾ƒä¸ºç®€å•ï¼Œä¹Ÿä¸éœ€è¦å¤ªå¤šå¤šä½™çš„å­˜å‚¨å’Œç½‘ç»œå¼€é”€ï¼Œä½†ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œåœ¨æ•°æ®å†™å…¥primary regionï¼Œåˆ°secondary regionå¯ä»¥è¯»åˆ°æ•°æ®ï¼Œæœ‰ç›¸å½“é•¿çš„æ—¶é—´é—´éš”ï¼Œä¸­é—´éœ€è¦ç­‰å¾…memstoreçš„flushå’ŒStorefileRefresherChoreä»»åŠ¡çš„å®šæ—¶åˆ·æ–°ã€‚</p>
<p>å¦‚æœè¦å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œåªè¦å°†<code>hbase.regionserver.storefile.refresh.period</code>é…ç½®è®¾ç½®ä¸ºéé›¶å€¼å³å¯ï¼Œè¡¨ç¤ºStorefileRefresherChoreä»»åŠ¡åˆ·æ–°çš„æ—¶é—´é—´éš”ã€‚</p>
<h4 id="Asynchronous-Replication"><a href="#Asynchronous-Replication" class="headerlink" title="Asynchronous Replication"></a>Asynchronous Replication</h4><p>HBaseæœ‰æä¾›é›†ç¾¤é—´replicationåŠŸèƒ½ï¼Œåˆ©ç”¨WALåœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´åŒæ­¥æ•°æ®ã€‚åœ¨HBase-1.1+ç‰ˆæœ¬ä¸­ï¼Œä¾¿åˆ©ç”¨replicationåœ¨é›†ç¾¤å†…éƒ¨åŒæ­¥æ•°æ®ï¼Œå°†å®æ—¶å†™å…¥çš„WALåŒæ­¥åˆ°secondary regionã€‚</p>
<p><img src="region_replica_replication.png" alt="Asynchronous Replicationç¤ºæ„å›¾" title="Asynchronous Replication ç¤ºæ„å›¾"></p>
<p>å¦‚ä¸Šå›¾ä¸­æ‰€ç¤ºï¼Œé€šè¿‡å®ç°ä¸€ä¸ªç‰¹æ®Šçš„<code>ReplicationEndpoint</code>ä¾¿å¯ä»¥å°†WALçš„æ•°æ®åŒæ­¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–RegionServerã€‚å¦‚æ­¤primary region MemStoreä¸­çš„æ•°æ®ï¼Œä¹Ÿé€šè¿‡replicationå®æ—¶åŒæ­¥åˆ°secondary regionï¼Œä»secondary regionä¸­ä¹Ÿå¯ä»¥è¯»åˆ°primary regionè¿˜æ²¡æœ‰flushåˆ°HFileçš„æ•°æ®ã€‚æ‰€ä»¥åˆ©ç”¨<code>Asnyc WAL replication</code>çš„åŒæ­¥æ–¹å¼æ¯”ä¸Šé¢è®²åˆ°çš„<code>StoreFile Refresher</code>åŒæ­¥æ–¹å¼å…·æœ‰æ›´ä½çš„åŒæ­¥å»¶è¿Ÿã€‚</p>
<p>primary regionè¿˜ä¼šå°†flushã€compactionå’Œbulk loadäº‹ä»¶å†™åˆ°WALï¼ŒåŒæ ·ç”±replicationåŠŸèƒ½åŒæ­¥åˆ°secondary regionã€‚å½“secondary regionæ¥æ”¶åˆ°è¿™äº›äº‹ä»¶æ—¶ï¼Œä¾¿ä¹Ÿå›æ”¾åŒæ ·çš„äº‹ä»¶æ¥æ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚æ‰€ä»¥å¯¹HFileæ–‡ä»¶åˆ—è¡¨çš„æ›´æ–°ä¹Ÿæ¯”<code>StoreFile Refresher</code>å®šæ—¶åˆ·æ–°çš„æ–¹å¼æ›´åŠ å®æ—¶ã€‚</p>
<p>åœ¨è¿™ç§åŒæ­¥æ¨¡å¼ä¸‹ï¼Œsecondary regionçš„MemStoreä¸­ä¹Ÿæ˜¯æœ‰æ•°æ®ï¼Œä»WALåŒæ­¥çš„Put/Deleteæ“ä½œå°±pPrimaryrRegionä¸€æ ·å†™å…¥MemStoreï¼Œå¹¶ä¸”secondary regionä¹Ÿä¼šä½¿ç”¨block cacheï¼Œæ‰€ä»¥åœ¨è¿™ç§æ¨¡å¼ä¸­å†…å­˜çš„å¼€é”€ä¼šæˆå€çš„å¢é•¿ã€‚ä¸åŒäºprimary regionçš„æ˜¯ï¼Œsecondary regionåœ¨æ¥æ”¶åˆ°flushäº‹ä»¶æ—¶ï¼Œå¹¶ä¸ä¼šå°†MemStoreä¸­çš„æ•°æ®flushæˆHFileï¼Œåªä¼šé‡Šæ”¾æ‰MemStoreå ç”¨çš„å†…å­˜ã€‚</p>
<p><code>Asnyc WAL replication</code>åŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ã€‚éœ€è¦è®¾ç½®<code>hbase.region.replica.replication.enabled</code>ä¸º<code>true</code>æ¥æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ã€‚å½“ç¬¬ä¸€æ¬¡åˆ›å»ºä¸€ä¸ªregion replicationå¤§äº1çš„è¡¨æ—¶ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>region_replica_replication</code>çš„replication peerï¼Œè¿™ä¸ªreplication peerå°†è´Ÿè´£é›†ç¾¤å†…æ‰€æœ‰è¡¨region replicaçš„æ•°æ®åŒæ­¥ã€‚ä¸€æ—¦å¼€å¯ä¹‹åæƒ³è¦å†å…³é—­è¯¥åŠŸèƒ½ï¼Œå°±ä¸åªæ˜¯æ”¹<code>hbase.region.replica.replication.enabled</code>ä¸º<code>false</code>äº†ï¼Œè¿˜éœ€è¦disableæ‰<code>region_replica_replication</code>è¿™ä¸ªreplication peerã€‚</p>
<h3 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><h4 id="HFileçš„è¿‡æœŸæ—¶é—´"><a href="#HFileçš„è¿‡æœŸæ—¶é—´" class="headerlink" title="HFileçš„è¿‡æœŸæ—¶é—´"></a>HFileçš„è¿‡æœŸæ—¶é—´</h4><p>åœ¨ä»¥ä¸Šä¸¤ç§æ•°æ®åŒæ­¥æ–¹å¼ä¸­ï¼Œéƒ½ä¼šåœ¨å¤šä¸ªRegionServerä¸Šæ‰“å¼€åŒä¸€ä¸ªHFileï¼Œæ‰€ä»¥å½“primary regionè¿›è¡Œå®Œäº†major compactionä¹‹åï¼Œsecondary regionå› ä¸ºHFileæ–‡ä»¶å˜åŒ–æ›´æ–°ä¸åŠæ—¶ï¼Œä¾æ—§å¼•ç”¨ç€æ—§çš„HFileã€‚ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æªæ–½ä¿è¯HFileæ–‡ä»¶å¹¶ä¸ä¼šè¢«è¿‡æ—©çš„åˆ é™¤ã€‚åªèƒ½æ˜¯å°†é…ç½®é¡¹<code>hbase.master.hfilecleaner.ttl</code>è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œæ¯”å¦‚ä¸€å°æ—¶ï¼Œä»¥æ­¤æ¥å°½é‡é¿å…è¯·æ±‚è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºé”™ã€‚ä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ HDFSçš„å­˜å‚¨å¼€é”€ã€‚</p>
<h4 id="replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®"><a href="#replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®" class="headerlink" title="replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®"></a>replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®</h4><p>ç›®å‰çš„Asynchronous ReplicationåŠŸèƒ½å¹¶ä¸èƒ½åŒæ­¥metaè¡¨çš„WALæ•°æ®ï¼ˆæœ€åˆè¯¥åŠŸèƒ½æ˜¯ç”¨äºé›†ç¾¤é—´åŒæ­¥æ•°æ®çš„ï¼Œæ¯•ç«Ÿä¸èƒ½æŠŠmetaæ•°æ®åŒæ­¥ç»™å…¶ä»–é›†ç¾¤ï¼‰ã€‚æ‰€ä»¥å¯¹äºmetaè¡¨çš„æ“ä½œï¼Œå¹¶ä¸èƒ½é€šè¿‡replicationå°½å¿«çš„åŒæ­¥åˆ°secondary regionï¼Œåªèƒ½é€šè¿‡ç±»ä¼¼äº<code>StoreFile Refresher</code>çš„æ–¹å¼ï¼Œä½¿ç”¨å®šæ—¶åˆ·æ–°çš„ä»»åŠ¡æ¥åŒæ­¥metaè¡¨HFileæ–‡ä»¶çš„å˜åŒ–ã€‚</p>
<p><code>hbase.regionserver.meta.storefile.refresh.period</code>é…ç½®é¡¹ç”¨äºæ§åˆ¶metaè¡¨StoreFileçš„æ›´æ–°æ—¶é—´ã€‚è¯¥é…ç½®é¡¹å¹¶ä¸åŒäº<code>StoreFile Refresher</code>åŠŸèƒ½çš„<code>hbase.regionserver.storefile.refresh.period</code>ã€‚</p>
<h4 id="å†…å­˜æ¶ˆè€—"><a href="#å†…å­˜æ¶ˆè€—" class="headerlink" title="å†…å­˜æ¶ˆè€—"></a>å†…å­˜æ¶ˆè€—</h4><p>åœ¨ä¹‹å‰å·²ç»æåˆ°ï¼ŒAsynchronous ReplicationåŒæ­¥å› ä¸ºä½¿ç”¨MemStoreå’Œblock cacheï¼Œä¼šå¯¼è‡´å†…å­˜å¼€é”€æˆå€å¢åŠ ã€‚å¹¶ä¸”secondary regionå¹¶ä¸ä¼šä¸»åŠ¨è¿›è¡Œflushï¼Œåªä¼šå½“æ¥æ”¶åˆ°åŒæ­¥çš„WALä¸­çš„flushäº‹ä»¶æ—¶ï¼Œæ‰ä¼šè¿›è¡Œflushã€‚åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚replicationé˜»å¡æ”¶ä¸åˆ°flushäº‹ä»¶ã€primary regionç¡®å®é•¿æ—¶é—´æ²¡æœ‰è¿›è¡ŒflushsecondaryarRegionæŒæœ‰çš„å†…å­˜å¾—ä¸åˆ°é‡Šæ”¾ï¼Œè€Œä¸€ä¸ªRegionServerä¸ŠåŒæ—¶æœ‰å¤šä¸ªprimary regionå’Œsecondary regionï¼Œå†…å­˜çš„è¿‡åº¦æ¶ˆè€—å¯èƒ½ä¼šé˜»å¡primary regionæ­£å¸¸çš„å†™å…¥æ“ä½œï¼Œä¹Ÿä¼šé˜»å¡replicationåŒæ­¥çš„flushäº‹ä»¶ã€‚</p>
<p>æ‰€ä»¥HBaseæä¾›äº†ä¸€ä¸ªé…ç½®é¡¹<code>hbase.region.replica.storefile.refresh.memstore.multiplier</code>ï¼Œé»˜è®¤å€¼ä¸º4ï¼Œè¡¨ç¤ºå¦‚æœsecondary regionçš„MemStoreæ¯”primary regionæœ€å¤§çš„MemStoreçš„4å€è¿˜è¦å¤§æ—¶ï¼Œä¾¿å…secondaryarRegionè‡ªè¡Œrefreshæ£€æŸ¥HFileæ–‡ä»¶æ˜¯å¦å˜åŒ–ï¼Œå¦‚æœprimary regionæ—©å·²flushè¿‡ï¼Œå´å› ä¸ºreplicationé˜»å¡æ²¡æœ‰åŒæ­¥åˆ°ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¯¥æœºåˆ¶è¿›è¡Œflushã€‚é»˜è®¤æƒ…å†µä¸‹æœ€å¥½ä¸è¦æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå¯ä»¥æŠŠè¯¥é…ç½®é¡¹è®¾ç½®å¤§ä¸€äº›æ¥é¿å…ã€‚</p>
<h4 id="secondary-region-Failover"><a href="#secondary-region-Failover" class="headerlink" title="secondary region Failover"></a>secondary region Failover</h4><p>å½“ä¸€ä¸ªsecondary regionåˆšopenæˆ–è€…fail overï¼Œæ­¤æ—¶å¿…ç„¶ä¸¢å¤±äº†ä¹‹å‰MemStoreçš„æ•°æ®ï¼Œå› ä¸ºsecondary regionæ¯•ç«Ÿä¸èƒ½åƒprimary regionä¸€æ ·é€šè¿‡å›æ”¾WALæ¥æ¢å¤MemStoreã€‚å¦‚æœæ­¤æ—¶ç›´æ¥æä¾›è¯»æœåŠ¡ï¼Œåˆ™å¯èƒ½å‡ºç°æ•°æ®ç‰ˆæœ¬å›é€€çš„é—®é¢˜ï¼Œå³æ¢å¤ä¹‹åæ¯”æ¢å¤ä¹‹å‰è¯»åˆ°çš„æ•°æ®æ›´æ—§ã€‚ä¸ºäº†é¿å…æ•°æ®å›é€€ï¼Œsecondary regionå°±å¿…é¡»ç­‰å¾…primary regionè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„flushæ“ä½œæˆ–open regionäº‹ä»¶ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œsecondary regionéƒ½å°†æ‹’ç»æ¥æœåŠ¡ã€‚</p>
<p><code>hbase.region.replica.wait.for.primary.flush</code>é…ç½®é¡¹æ˜¯è¯¥æœºåˆ¶çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯<code>enable</code>å¼€å¯ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p><strong>serverç«¯</strong></p>
<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>é»˜è®¤å€¼</th>
<th>å•ä½</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>hbase.regionserver.storefile.refresh.period</td>
<td>0</td>
<td>æ¯«ç§’</td>
<td>secondary regionåˆ·æ–°storefileçš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤0ä¸ºå…³é—­</td>
</tr>
<tr>
<td>hbase.regionserver.meta.storefile.refresh.period</td>
<td>0</td>
<td>æ¯«ç§’</td>
<td>secondary regionåˆ·æ–°hbase:metaè¡¨storefileçš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤0ä¸ºå…³é—­</td>
</tr>
<tr>
<td>hbase.region.replica.replication.enabled</td>
<td>false</td>
<td></td>
<td>æ˜¯å¦å¼€å¯<code>Asnyc WAL replication</code>åŠŸèƒ½ï¼Œå¼€å¯åå†æƒ³å…³é—­ï¼Œéœ€è¦æ”¹ä¸ºfalseä¹‹åå†disableæ‰<code>region_replica_replication</code>çš„peer</td>
</tr>
<tr>
<td>hbase.master.hfilecleaner.ttl</td>
<td>300000(5åˆ†é’Ÿ)</td>
<td>æ¯«ç§’</td>
<td>storefileæ–‡ä»¶çš„è¿‡æœŸåˆ é™¤æ—¶é—´é—´éš”</td>
</tr>
<tr>
<td>hbase.meta.replica.count</td>
<td>1</td>
<td>ä¸ª</td>
<td>metaè¡¨çš„region replicationæ•°é‡</td>
</tr>
<tr>
<td>hbase.region.replica.storefile.refresh.memstore.multiplier</td>
<td>4</td>
<td>å€</td>
<td>secondary regionçš„MemStoreå¤§äºåŒRegionServerä¸Šprimary regionæœ€å¤§çš„MemStoreè¯¥å€æ•°æ—¶ï¼Œä¼šè§¦å‘åˆ·æ–°storefileæ–‡ä»¶åˆ—è¡¨çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>hbase.region.replica.wait.for.primary.flush</td>
<td>true</td>
<td></td>
<td>secondary region openä¹‹åï¼Œæ˜¯å¦è¦ç­‰å¾…primary regionè¿›è¡Œä¸€æ¬¡flushå†æä¾›æœåŠ¡</td>
</tr>
<tr>
<td>hbase.master.loadbalancer.class</td>
<td>org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer</td>
<td></td>
<td>é»˜è®¤çš„å®ç°å¯ä»¥ä¿è¯regionçš„replicaså°½é‡ä¸ä¼šåˆ†å¸ƒåœ¨åŒä¸€ä¸ªRegionServerä¸Šï¼Œå¦‚æœä¿®æ”¹è¯¥é…ç½®ï¼Œè¦æ³¨æ„replicasçš„åˆ†å¸ƒ</td>
</tr>
</tbody></table>
<p><strong>clientç«¯</strong></p>
<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>é»˜è®¤å€¼</th>
<th>å•ä½</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>hbase.ipc.client.specificThreadForWriting</td>
<td>false</td>
<td></td>
<td>æ˜¯å¦ä½¿ç”¨ç‰¹æ®Šçº¿ç¨‹ç”¨äºå†™è¯·æ±‚ã€‚ä½¿ç”¨region replicasåŠŸèƒ½ï¼Œç»å¸¸ä¼šåœ¨IOè¿‡ç¨‹ä¸­ä¸­æ–­çº¿ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»å¼€å¯è¯¥é…ç½®</td>
</tr>
<tr>
<td>hbase.client.primaryCallTimeout.get</td>
<td>10000</td>
<td>å¾®ç§’</td>
<td>TIMELINEä¸€è‡´æ€§Getæ—¶ï¼Œç­‰å¾…primary regionå“åº”çš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åä¾¿è¯·æ±‚secondary region</td>
</tr>
<tr>
<td>hbase.client.primaryCallTimeout.scan</td>
<td>10000</td>
<td>å¾®ç§’</td>
<td>TIMELINEä¸€è‡´æ€§Scanæ—¶ï¼Œç­‰å¾…primary regionå“åº”çš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åä¾¿è¯·æ±‚secondary region</td>
</tr>
<tr>
<td>hbase.meta.replicas.use</td>
<td>false</td>
<td></td>
<td>æ˜¯å¦ä½¿ç”¨metaè¡¨çš„secondary region</td>
</tr>
</tbody></table>
<h3 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h3><p><code>REGION_REPLICATION</code>å‚æ•°æ§åˆ¶è¡¨ä¸­regionæœ‰å¤šå°‘å¤‡ä»½ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œå³åªæœ‰primary regionã€‚</p>
<p>shellæ–¹å¼å»ºè¡¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">create 't1', 'f1', &#123;REGION_REPLICATION =&gt; 2&#125;</span><br></pre></td></tr></table></figure>
<p>shellæ–¹å¼ä¿®æ”¹è¡¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alter 't1', &#123;REGION_REPLICATION =&gt; 2&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><p>Clientè®¿é—®secondary regionå¿…é¡»è¦ç”¨æˆ·æ˜ç¡®çš„è¡¨ç¤ºå¯ä»¥æ¥æ”¶éå¼ºä¸€è‡´æ€§çš„æ•°æ®ï¼Œå¦‚æœå¸Œæœ›è¯·æ±‚å¯ä»¥å‘é€ç»™secondary regionï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šä¸º<code>TIMELINE</code>çš„ä¸€è‡´æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Consistency &#123;</span><br><span class="line">    STRONG,</span><br><span class="line">    TIMELINE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h4><p>å…è®¸ä»¥<code>TIMELINE</code>çš„ä¸€è‡´æ€§è¯»å–æ•°æ®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hbase(main):001:0&gt; get 't1','r6', &#123;CONSISTENCY =&gt; "TIMELINE"&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hbase(main):001:0&gt; get 't1','r6', &#123;CONSISTENCY =&gt; "TIMELINE", , REGION_REPLICA_ID =&gt; 1&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><p>Get</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Get get = <span class="keyword">new</span> Get(row);</span><br><span class="line">get.setConsistency(Consistency.TIMELINE);</span><br><span class="line">...</span><br><span class="line">Result result = table.get(get);</span><br></pre></td></tr></table></figure>
<p>Scan</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">scan.setConsistency(Consistency.TIMELINE);</span><br><span class="line">...</span><br><span class="line">ResultScanner scanner = table.getScanner(scan);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡<code>Result.isStale()</code>åˆ¤æ–­æ•°æ®æ˜¯å¦æ¥è‡ªäºsecondary region</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Result result = table.get(get);</span><br><span class="line"><span class="keyword">if</span> (result.isStale()) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h2><p><strong>æœºå™¨é…ç½®</strong></p>
<p>HBaseç‰ˆæœ¬ï¼š2.2.0<br>HDFSç‰ˆæœ¬ï¼š 3.1.4</p>
<table>
<thead>
<tr>
<th>service</th>
<th>job</th>
<th>å®ä¾‹æ•°</th>
<th>cpu</th>
<th>disk</th>
<th>netowork</th>
<th>comment</th>
</tr>
</thead>
<tbody><tr>
<td>HBase</td>
<td>master</td>
<td>2</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>HBase</td>
<td>region server</td>
<td>5</td>
<td>24 core</td>
<td>12*3.7T HDD</td>
<td>10000bps</td>
<td>onheap=50g/offheap=50g</td>
</tr>
<tr>
<td>HDFS</td>
<td>namenode</td>
<td>2</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>onheap=10g</td>
</tr>
<tr>
<td>HDFS</td>
<td>datanode</td>
<td>5</td>
<td>24 core</td>
<td>12*3.7T HDD</td>
<td>10000bps</td>
<td>onheap=2g</td>
</tr>
</tbody></table>
<p><strong>ä¸é™åˆ¶QPS</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>strong</th>
<th>timeline-10ms</th>
<th>reta</th>
</tr>
</thead>
<tbody><tr>
<td>qps_sec</td>
<td>12608.23</td>
<td>11171.18</td>
<td>-11.4%</td>
</tr>
<tr>
<td>max_latency_us</td>
<td>195174.38</td>
<td>202603.69</td>
<td>3.81%</td>
</tr>
<tr>
<td>min_latency_us</td>
<td>149.38</td>
<td>148.75</td>
<td>-0.42%</td>
</tr>
<tr>
<td>avg_latency_us</td>
<td>3760.69</td>
<td>4276.76</td>
<td>13.72%</td>
</tr>
<tr>
<td>p90_latency_us</td>
<td>11811.92</td>
<td>14258.31</td>
<td>20.71%</td>
</tr>
<tr>
<td>p99_latency_us</td>
<td>32512.23</td>
<td>31148.14</td>
<td>-4.2%</td>
</tr>
<tr>
<td>p999_latency_us</td>
<td>64646.38</td>
<td>58621.93</td>
<td>-9.32%</td>
</tr>
<tr>
<td>p9999_latency_us</td>
<td>136835.92</td>
<td>115951.63</td>
<td>-15.26%</td>
</tr>
</tbody></table>
<p><strong>é™åˆ¶7000QPS</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>strong</th>
<th>timeline-10ms</th>
<th>reta</th>
</tr>
</thead>
<tbody><tr>
<td>qps_sec</td>
<td>6999.58</td>
<td>6999.56</td>
<td>-0.0%</td>
</tr>
<tr>
<td>max_latency_us</td>
<td>126860.75</td>
<td>130148.86</td>
<td>2.59%</td>
</tr>
<tr>
<td>min_latency_us</td>
<td>147.25</td>
<td>150.68</td>
<td>2.33%</td>
</tr>
<tr>
<td>avg_latency_us</td>
<td>3223.38</td>
<td>3495.51</td>
<td>8.44%</td>
</tr>
<tr>
<td>p90_latency_us</td>
<td>10612.49</td>
<td>11379.48</td>
<td>7.23%</td>
</tr>
<tr>
<td>p99_latency_us</td>
<td>23793.54</td>
<td>24469.25</td>
<td>2.84%</td>
</tr>
<tr>
<td>p999_latency_us</td>
<td>48791.00</td>
<td>39795.06</td>
<td>-18.44%</td>
</tr>
<tr>
<td>p9999_latency_us</td>
<td>93389.08</td>
<td>78618.61</td>
<td>-15.82%</td>
</tr>
</tbody></table>
<p>å¯¹å•Clientå®ä¾‹åšå‹åŠ›æµ‹è¯•ï¼Œ<code>hbase.client.primaryCallTimeout.get</code>å‚æ•°è®¾ç½®ä¸º10000ï¼Œå³ç­‰å¾…primary regionå“åº”çš„æ—¶é—´è¶…æ—¶10msä¹‹åä¾¿è¯·æ±‚secondary regionã€‚</p>
<p>ç¬¬ä¸€ç»„æé™QPSçš„å‹æµ‹ä¸­ï¼Œå¯ä»¥çœ‹å‡ºå¼€å¯TIMELINE Readä¹‹åï¼ŒQPSæœ‰ä¸€å®šæŸå¤±ï¼Œå¹³å‡å»¶è¿Ÿæœ‰ä¸€å®šå‡é«˜ï¼ŒP999å’ŒP9999ä¸€å®šç¨‹åº¦ä¼˜åŒ–ã€‚ä¼˜åŒ–æ•ˆæœæœ‰é™ã€‚</p>
<p>å› ä¸ºread replicasä¼šå¢åŠ çº¿ç¨‹èµ„æºçš„ä½¿ç”¨ï¼Œè€Œæ—¥å¸¸ä½¿ç”¨ä¹Ÿä¸ä¼šæŠŠClientä¾§å‹åˆ°æé™ï¼Œæ‰€ä»¥åˆåšäº†ä¸€ç»„é™åˆ¶QPSçš„å‹æµ‹ï¼Œå¯ä»¥çœ‹åˆ°å„é¡¹å»¶è¿ŸæŒ‡æ ‡å‡æœ‰æ‰€å¥½è½¬ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>Region Replica</code>åŠŸèƒ½å¯ä»¥æé«˜HBaseçš„è¯»å¯ç”¨æ€§ï¼Œä½†ä¹Ÿè¦æ ¹æ®å…·ä½“çš„ç”¨ä¾‹è€ƒè™‘æ˜¯å¦é€‚ç”¨ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å½“åº”ç”¨ä¾èµ–æ˜¯åªè¯»çš„è¡¨ï¼Œæˆ–è€…åº”ç”¨å¹¶ä¸è¦æ±‚å¼ºä¸€è‡´æ€§ï¼ˆè¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¯ä»¥æ¥å—çŸ­æ—¶é—´å†…æ•°æ®ä¸ä¸€è‡´ï¼‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½æ¥æé«˜è¯»å¯ç”¨æ€§ã€‚åœ¨RegionServeræˆ–Regionå‡ºç°å•ç‚¹æ•…éšœæ¢å¤æœŸé—´æˆ–é•¿æ—¶é—´Full GCæœŸé—´å°½é‡ä¿è¯ä¸šåŠ¡è¯»è¯·æ±‚æ­£å¸¸ï¼Œå‡å°‘MTTRè¿‡é•¿å¯¹ä¸šåŠ¡äº§ç”Ÿçš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘å¤§é‡é‡è¯•è¯·æ±‚è¿›ä¸€æ­¥åœ°å¢åŠ æ•…éšœèŠ‚ç‚¹çš„å‹åŠ›ã€‚</li>
<li>å¯¹äºéƒ¨åˆ†ä¸è¦æ±‚å¼ºä¸€è‡´æ€§ä¸”å¯¹å»¶è¿Ÿæ¯›åˆºæœ‰ä¸€å®šè¦æ±‚çš„åº”ç”¨ï¼Œå½“åœ¨Clientä¾§QPSè¾ƒä½æˆ–CPUã€å¸¦å®½ç­‰èµ„æºå¯Œä½™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½é™ä½è¯»è¯·æ±‚P99/P999å’ŒP9999å»¶è¿Ÿã€‚</li>
</ul>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>å¤šå€çš„MemStoreå¯¼è‡´æ›´å¤šçš„å†…å­˜æ¶ˆè€—</li>
<li>å¢åŠ block cacheçš„éœ€æ±‚å’Œä½¿ç”¨</li>
<li>ä¸ºäº†ä¼ è¾“WALå¯¼è‡´æ›´å¤šçš„ç½‘ç»œå¸¦å®½æ¶ˆè€—</li>
<li>å¤§é‡çš„é›†ç¾¤å†…éƒ¨RPCè¯·æ±‚</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://hbase.apache.org/book.html#arch.timelineconsistent.reads" target="_blank" rel="noopener">Timeline-consistent High Available Reads</a></li>
<li><a href="https://issues.apache.org/jira/browse/HBASE-10070" target="_blank" rel="noopener">HBASE-10070</a></li>
<li><a href="https://issues.apache.org/jira/secure/attachment/12616659/HighAvailabilityDesignforreadsApachedoc.pdf" target="_blank" rel="noopener">HighAvailabilityDesignforreadsApachedoc.pdf</a></li>
</ul>
]]></content>
      <categories>
        <category>HBase</category>
      </categories>
      <tags>
        <tag>HBase</tag>
        <tag>Region Replicas</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè®°ã€Jdk8 CompletableFutureåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ€§èƒ½é—®é¢˜</title>
    <url>/blog/2019/10/11/CompletableFuture-in-high-concurrent/</url>
    <content><![CDATA[<p>æœ€è¿‘çš„å·¥ä½œå†…å®¹å°±æ˜¯å†™ä¸€ä¸ª DualHBaseClientï¼Œåœ¨æŸ¥è¯¢æ•°æ®æ—¶é—´è¿‡é•¿æ—¶ï¼Œèƒ½å¤Ÿå°†åŒæ ·çš„è¯·æ±‚å‘ç»™ replication çš„é›†ç¾¤ï¼Œç¼©å° client ç«¯çš„ p99ã€p999 å»¶è¿Ÿï¼Œå‡å°æ¯›åˆºã€‚<br>å®é™…å¼€å‘æœ€åˆçš„ä¸€ç‰ˆä»£ç éƒ½æ²¡æœ‰èŠ±è´¹1pdï¼Œæ€§èƒ½æµ‹è¯•å€’æµ‹äº†å¥½å‡ å¤©éƒ½ä¸åŠé¢„æœŸï¼Œç”šè‡³ä¼˜åŒ–ä¹‹åå„æ–¹é¢æ€§èƒ½æ›´å·®åŠ²ã€‚</p>
<p>æœ¬æ–‡å°±æ˜¯è®°å½•ä¸‹å¯¼è‡´æ­¤æ¬¡æ€§èƒ½é—®é¢˜çš„ä¸»è¦åŸå› ï¼šCompletableFuture.</p>
<p>ä½¿ç”¨ Java å¼‚æ­¥ç¼–ç¨‹çš„æ—¶å€™ï¼ŒCompletableFuture ç”¨èµ·æ¥è¿˜æ˜¯ç›¸å½“èˆ’æœçš„ï¼Œåœ¨HBaseçš„å¼‚æ­¥APIé‡Œï¼Œä¹Ÿå¤§é‡çš„ä½¿ç”¨äº†CompletableFutureï¼Œå¦‚æœ CompletableFuture æœ‰æ€§èƒ½é—®é¢˜ï¼Œé‚£å¯å°±æ‚²å‚¬äº†ã€‚</p>
<a id="more"></a>

<p>çœ‹ä¸‹ä»¥ä¸‹è¿™æ®µæµ‹è¯•CompletableFutureçš„ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.google.common.collect.Lists;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.concurrent.CompletableFuture;</span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line"></span><br><span class="line">public class FutureTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class="line">        new FutureTest().run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void run() throws ExecutionException, InterruptedException &#123;</span><br><span class="line">        List&lt;CompletableFuture&gt; futures &#x3D; Lists.newArrayList();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 1000; i++) &#123;</span><br><span class="line">            CompletableFuture future &#x3D; new CompletableFuture();</span><br><span class="line">            CompletableFuture f &#x3D; CompletableFuture.runAsync(this::read);</span><br><span class="line">            f.whenComplete((r, e) -&gt; future.complete(r));</span><br><span class="line">            futures.add(future);</span><br><span class="line">        &#125;</span><br><span class="line">        for (CompletableFuture future : futures) &#123;</span><br><span class="line">            future.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void read() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(100);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šè¿™æ®µä»£ç å®é™…åªæ˜¯è®© CompletableFuture ç©ºè½¬ï¼Œé™¤äº† sleep æ²¡å†åšå…¶ä»–çš„ï¼Œå¾ªç¯1000è®©è¿è¡Œæ—¶é—´å°½é‡é•¿ä¸€äº›ï¼Œè¶³å¤Ÿè®©æˆ‘ä»¬è·‘ä¸€ä¸ªç«ç„°å›¾å‡ºæ¥ã€‚</p>
<p><img src="CompletableFuture-in-jdk8-traces.svg" alt="ç«ç„°å›¾"></p>
<p>ç«ç„°å›¾é‡Œæ³¨æ„åˆ°æœ‰ä¸ªæœ€å¤§çš„å¹³é¡¶ java.lang.Runtime.availableProcessorsï¼Œè¯¥æ–¹æ³•è€—æ—¶æå¤§ï¼Œç”šè‡³è¶…è¿‡äº† Thread.sleepï¼Œè¿™å¯ä¸æ­£å¸¸å§ã€‚</p>
<p>éšåæˆ‘ä»¬æµ‹ä¸‹ java.lang.Runtime.availableProcessors() æ–¹æ³•æ˜¯ä¸æ˜¯çœŸçš„æ…¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import com.google.common.base.Stopwatch;</span><br><span class="line">import org.junit.Assert;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class AvailableProcessorsTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        Stopwatch sw &#x3D; Stopwatch.createStarted();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 1000000; i++) &#123;</span><br><span class="line">            Runtime.getRuntime().availableProcessors();</span><br><span class="line">        &#125;</span><br><span class="line">        Assert.assertTrue(sw.elapsed(TimeUnit.SECONDS) &gt; 10);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æˆ‘çš„æœºå™¨ä¸Šå¾ªç¯1000000æ¬¡ï¼Œè€—æ—¶è¶…è¿‡äº†10sï¼Œä¸ç®—å¿«ã€‚</p>
<p>å†æ¥çœ‹çœ‹ CompletableFuture æ˜¯æ€ä¹ˆä½¿ç”¨ Runtime.availableProcessors() çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">private Object waitingGet(boolean interruptible) &#123;</span><br><span class="line">    ...</span><br><span class="line">    while ((r &#x3D; result) &#x3D;&#x3D; null) &#123;</span><br><span class="line">        if (spins &lt; 0)</span><br><span class="line">            spins &#x3D; (Runtime.getRuntime().availableProcessors() &gt; 1) ?</span><br><span class="line">                1 &lt;&lt; 8 : 0; &#x2F;&#x2F; Use brief spin-wait on multiprocessors</span><br><span class="line">        else if (spins &gt; 0) &#123;</span><br><span class="line">            if (ThreadLocalRandom.nextSecondarySeed() &gt;&#x3D; 0)</span><br><span class="line">                --spins;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>while æ­»å¾ªç¯è¦ç›´åˆ°å‡ºç°å¼‚å¸¸æˆ–è·å–åˆ°æœ€ç»ˆç»“æœæ‰ä¼šç»“æŸï¼Œè€Œå¾ªç¯ä¸­åˆä¼šå¤§é‡è°ƒç”¨ Runtime.availableProcessors()ï¼Œè¿™å°±æ˜¯ CompletableFuture å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p>è€Œå®é™…ä¸ŠOpenjdkå·²æœ‰å¯¹è¯¥é—®é¢˜çš„è®¨è®ºï¼Œ<a href="https://bugs.openjdk.java.net/browse/JDK-8227018" target="_blank" rel="noopener">JDK-8227018</a>ï¼Œè¯¥ä¼˜åŒ–ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨è¿™é‡Œå…¶å®åªæ˜¯éœ€è¦çŸ¥é“è¿è¡Œç¯å¢ƒæ˜¯ä¸æ˜¯å¤šå¤„ç†å™¨ç¯å¢ƒè€Œå·²ï¼Œç¼“å­˜èµ·æ¥å°±å¥½ï¼Œå®Œå…¨æ²¡å¿…è¦æ¯æ¬¡å¾ªç¯éƒ½å»è·å–ã€‚åœ¨jdk8u232ç‰ˆæœ¬å°±fixæ‰äº†ã€‚</p>
<p>è€Œä¸”æˆ‘è¿˜çœ‹äº† jdk11ã€jdk13 çš„å®ç°ï¼Œéƒ½ä¸å†ä½¿ç”¨ Runtime.availableProcessors() äº†ï¼Œæ‰€ä»¥ç®—æ˜¯ä½ç‰ˆæœ¬ jdk8 ç”¨æˆ·ç‹¬æœ‰çš„çƒ¦æ¼ã€‚</p>
<blockquote>
<p>ä¸€ä¸ªå°æ’æ›²</p>
<p>jdk8u232ç‰ˆæœ¬æ˜¯2019.10.15æ‰æ­£å¼releaseçš„ï¼Œè€Œæˆ‘å‘ç°è¿™ä¸ªé—®é¢˜æ˜¯åœ¨10.13ã€‚<br>ä¹Ÿå¹¸è¿ä¹Ÿä¸å¹¸ï¼Œå¹¸è¿çš„æ˜¯èµ·ç é—®é¢˜fixæ‰äº†ï¼Œä¸å¹¸çš„æ˜¯ DualHBaseClient ä¸èƒ½é‡‡ç”¨ CompletableFuture å®ç°äº†ï¼Œæ€»ä¸å¥½è¦æ±‚ç”¨æˆ·å‡çº§jdkå§</p>
</blockquote>
<p>çŸ¥é“ä½ç‰ˆæœ¬çš„ jdk8 æœ‰é—®é¢˜ä¹‹åï¼ŒDualHBaseClient è¿˜æ˜¯è¦å†™çš„ï¼Œåªèƒ½å¯»æ±‚å…¶ä»–çš„å¼‚æ­¥æ¡†æ¶æ¥å®ç°ï¼Œå¥½åœ¨ guava çš„ ListenableFuture å®ç°å¾ˆåƒ CompletableFutureã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœæ˜¯jdk8ä½ç‰ˆæœ¬ç”¨æˆ·ï¼ˆåˆšå‘å¸ƒå‡ å¤©ä¸ä¼šæœ‰å…¬å¸å‡çº§å§ï¼‰é¢‘ç¹çš„å¤§é‡ä½¿ç”¨ CompletableFutureï¼Œæ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œå‡çº§ jdk æ˜¯æœ€ç®€å•çš„åŠæ³•ï¼Œä½¿ç”¨ guava çš„ Future åº“å®ç°ä¹Ÿå¯ä»¥ï¼Œä½†å¯èƒ½è¦å¤§é‡ä¿®æ”¹ä»£ç äº†ã€‚</p>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><ul>
<li><a href="https://blog.wangqi.love/articles/Java/%E7%81%AB%E7%84%B0%E5%9B%BE%E6%8E%92%E6%9F%A5Java%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98.html" target="_blank" rel="noopener">ç«ç„°å›¾æ’æŸ¥Javaæ€§èƒ½é—®é¢˜</a></li>
<li><a href="https://bugs.openjdk.java.net/browse/JDK-8227018" target="_blank" rel="noopener">JDK-8227018</a></li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Jdk</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè®°ã€å­ç±»å¤å†™çˆ¶ç±»æ–¹æ³•ä¸ç±»åˆå§‹åŒ–é¡ºåºå¼•å‘çš„bug</title>
    <url>/blog/2019/09/30/class-init-order-in-inheritance/</url>
    <content><![CDATA[<h2 id="bugç°è±¡"><a href="#bugç°è±¡" class="headerlink" title="bugç°è±¡"></a>bugç°è±¡</h2><p>bugå‡ºç°çš„æ¡ä»¶ï¼š</p>
<ul>
<li>ç»§æ‰¿å…³ç³»</li>
<li>å­ç±»å±æ€§æœ‰é»˜è®¤çš„åˆå§‹åŒ–</li>
<li>å­ç±»å¤å†™äº†çˆ¶ç±»çš„é’©å­æ–¹æ³•</li>
<li>é’©å­æ–¹æ³•åœ¨çˆ¶ç±»æ„é€ æ–¹æ³•ä¸­è°ƒç”¨</li>
</ul>
<a id="more"></a>

<p>å¯ä»¥çœ‹ä¸‹ä»¥ä¸‹çš„ç¤ºä¾‹ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class Father &#123;</span><br><span class="line"></span><br><span class="line">    public Father() &#123;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void init() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class Child extends Father &#123;</span><br><span class="line"></span><br><span class="line">    int a &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    public Child() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void init() &#123;</span><br><span class="line">        super.init();</span><br><span class="line">        a &#x3D; 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import static org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line">public class ChildTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testConstructor() &#123;</span><br><span class="line">        Child child &#x3D; new Child();</span><br><span class="line">        assertEquals(0, child.a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç±»åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½è¿‡ç¨‹</h2><p>é¡ºä¾¿å¤ä¹ ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ï¼Œç±»åŠ è½½è¿‡ç¨‹åˆ†ä¸ºåŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–ä¸‰å¤§æ­¥éª¤</p>
<p>åŠ è½½ï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµæ•°æ®ï¼Œå¹¶ä¸”æ®æ­¤åˆ›å»ºç±»ï¼Œå³ä»£è¡¨è¿™ä¸ªç±»çš„Classå¯¹è±¡ã€‚</p>
<p>é“¾æ¥ï¼šå°†åˆ›å»ºæˆçš„ç±»åˆå¹¶è‡³Javaè™šæ‹Ÿæœºä¸­ï¼Œä½¿ä¹‹èƒ½å¤Ÿæ‰§è¡Œçš„è¿‡ç¨‹ã€‚è¿˜åˆ†éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªé˜¶æ®µã€‚</p>
<ul>
<li>éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§</li>
<li>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</li>
<li>è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li>
</ul>
<p>åˆå§‹åŒ–ï¼šæ ‡è®°ä¸ºå¸¸é‡å€¼çš„å­—æ®µèµ‹å€¼ï¼Œä»¥åŠæ‰§è¡Œæ–¹æ³•ã€‚åˆå§‹åŒ–çš„æ—¶æœºï¼š</p>
<ol>
<li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–ç”¨æˆ·æŒ‡å®šçš„ä¸»ç±»</li>
<li>å½“é‡åˆ°ä»¥æ–°å»ºç›®æ ‡ç±»å®ä¾‹çš„newæŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–newæŒ‡å®šçš„ç›®æ ‡ç±»</li>
<li>å½“é‡åˆ°è°ƒç”¨é™æ€æ–¹æ³•çš„æŒ‡ä»¤å­—æ®µæ˜¯ï¼Œåˆå§‹åŒ–è¯¥é™æ€æ–¹æ³•æ‰€åœ¨çš„ç±»</li>
<li>å½“é‡åˆ°è®¿é—®é™æ€å­—æ®µçš„æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–è¯¥é™æ€å­—æ®µæ‰€åœ¨çš„ç±»</li>
<li>å­ç±»çš„åˆå§‹åŒ–ä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li>
<li>å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº†defaultæ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥å®ç°è¯¥æ¥å£çš„ç±»åˆå§‹åŒ–ï¼Œä¼šè§¦</li>
<li>è¯¥æ¥å£çš„åˆå§‹åŒ–</li>
<li>ä½¿ç”¨åå°„APIå¯¹æŸä¸ªç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶ï¼Œåˆå§‹åŒ–è¿™ä¸ªç±»</li>
<li>å½“åˆæ¬¡è°ƒç”¨MethodHandleå®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥MethodHandleæŒ‡å‘çš„æ–¹æ³•æ‰€åœ¨çš„ç±»</li>
</ol>
<h2 id="ç±»åˆå§‹åŒ–é¡ºåº"><a href="#ç±»åˆå§‹åŒ–é¡ºåº" class="headerlink" title="ç±»åˆå§‹åŒ–é¡ºåº"></a>ç±»åˆå§‹åŒ–é¡ºåº</h2><ol>
<li>æŒ‰å®šä¹‰é¡ºåºåˆå§‹åŒ–çˆ¶ç±»çš„staticæˆå‘˜ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</li>
<li>æŒ‰å®šä¹‰é¡ºåºåˆå§‹åŒ–å­ç±»çš„staticæˆå‘˜ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</li>
<li>æŒ‰å®šä¹‰é¡ºåºæ‰§è¡Œçˆ¶ç±»çš„æ™®é€šæˆå‘˜åˆå§‹åŒ–</li>
<li>æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°</li>
<li>æŒ‰å®šä¹‰é¡ºåºæ‰§è¡Œå­ç±»çš„æŒ‡å®šåˆå§‹åŒ–</li>
<li>æ‰§è¡Œå­ç±»çš„æ„é€ å‡½æ•°</li>
</ol>
<h2 id="å›å¤´è§£bug"><a href="#å›å¤´è§£bug" class="headerlink" title="å›å¤´è§£bug"></a>å›å¤´è§£bug</h2><p>ç°åœ¨å†å›å¤´çœ‹ä¸‹bugä»£ç å°±çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼šçˆ¶ç±»æ‰§è¡Œæ„é€ æ–¹æ³•æ—¶è°ƒç”¨äº†ä¼šä¿®æ”¹å­ç±»æˆå‘˜<code>a</code>çš„é’©å­æ–¹æ³•ï¼Œç„¶åå­ç±»æ‰åˆå§‹åŒ–äº†è‡ªå·±çš„æˆå‘˜ï¼Œè¦†ç›–äº†é’©å­æ–¹æ³•é‡Œå¯¹<code>a</code>çš„ä¿®æ”¹ã€‚</p>
<p>è§£å†³æ–¹æ³•ä¹Ÿç®€å•ï¼Œå¯¹<code>a</code>ä¸åŠ é»˜è®¤å€¼å°±å¥½äº†ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>bug</tag>
      </tags>
  </entry>
</search>
